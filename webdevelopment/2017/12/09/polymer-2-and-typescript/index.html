<!DOCTYPE html><!--[if lt IE 9]> <html class="lt-ie9" lang="en"> <![endif]--><!--[if IE 9]>    <html class="ie9" lang="en"> <![endif]--><!--[if gt IE 9]><!--><html xmlns=http://www.w3.org/1999/xhtml class=gt-ie9 lang=en><!--<![endif]--><head><!-- version 0.3.5 --><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=author content="mdworld 0.3.5"><title>Polymer 2 and TypeScript</title><link rel="shortcut icon" href=/mdworld-ingram/img/favicon.ico type=image/x-icon><link rel=stylesheet href=/mdworld-ingram/css/all.css></head><body><div class=site><nav class="navbar navbar-inverse navbar-fixed-top"><div><div class=container><div class=row><ul class="nav navbar-nav navbar-right"><li><a href=/mdworld-ingram/ ><span class="glyphicon glyphicon-home"></span> home</a></li><li><a href=/mdworld-ingram/#blog><span class="glyphicon glyphicon-pencil"></span> blog</a></li><li><a href=https://twitter.com/mdworldNL><span class=twitter></span> <span class=label-optional>@mdworldNL</span></a></li><li><a href=# data-toggle=modal data-target=#contactModal><span class="glyphicon glyphicon-envelope"></span> <span class=label-optional>contact</span></a></li></ul></div></div></div><header><h1 class="title post-title container">Polymer 2 and TypeScript</h1></header></nav><p class="meta container">09 Dec 2017</p><div class="post container"><div class=multi-column-text><h1>Polymer 2 and TypeScript</h1><p>For <a href=http://mdworld.nl/blog/webdevelopment/2017/07/30/polymer2-redux/ >reasons beyond my control</a> I&#39;m working with Polymer 2 at the moment. Although the idea of web components is great, the choice for HTML imports that comes with Polymer 2 makes integration into a modern development stack cumbersome, as will become clear soon. Also, HTML imports are not widely supported by browsers and although polyfills exist, only <a href="https://caniuse.com/#search=html%20imports">Chrome (surprise!)</a> will have native support for the foreseeable future.</p><p>Using TypeScript seems like a good choice, because static typing helps prevent runtime errors. Additionally it would be a good opportunity to try out the <a href=https://github.com/code-star/scala-ts-interfaces>Scala-TS-interfaces project</a> by my colleagues, that can generate TypeScript from a Scala domain model. Unfortunately, adding TypeScript to a Polymer 2 development stack proves to be difficult, whereas using it with Polymer 3 seems trivial. Polymer 3 is currently in preview so it is not a viable option for me for the moment, but it will exchange HTML imports for ES6 Modules. This will make integrating it into a modern development stack much easier. An <a href=https://github.com/mdvanes/polymer3-typescript>example</a> already exists, by <a href=https://github.com/pferretti>Paolo Ferretti</a> and follows normal conventions for a TypeScript project.</p><p>If you&#39;re adventurous, don&#39;t need any <a href=https://www.webcomponents.org/ >existing Polymer 2 elements</a> and don&#39;t need to run production; stop reading here and use Polymer 3. If you need Polymer 2 read on, but be warned that it won&#39;t be pretty.</p><p><strong>TL;DR to use TypeScript with Polymer 2 use <a href=https://github.com/mdvanes/typescript-batch-compiler>typescript-batch-compiler</a> or even better <a href=https://github.com/Draccoz/twc>twc</a>.</strong></p><h2>Webpack</h2><p>For this experiment I will use my existing Polygram project and the result will be available in the <a href=https://github.com/mdvanes/polygram/tree/TypeScript>TypeScript branch</a>.</p><p>The first challenge is to use Webpack with Polymer 2. Although not strictly necessary for TypeScript compilation, it would make sense for importing HTML as modules. Fortunately, <a href="https://www.youtube.com/playlist?list=PLOU2XLYxmsII5c3Mgw6fNYCzaWrsM3sMN">Rob Dodson himself</a> wrote an article <a href=http://robdodson.me/how-to-use-polymer-with-webpack/ >How to use Polymer with Webpack</a>. It even mentions TypeScript! The article introduces the Webpack loader <a href=https://github.com/webpack-contrib/polymer-webpack-loader>https://github.com/webpack-contrib/polymer-webpack-loader</a> and explains how it extracts the JavaScript from the HTML of Polymer elements and eventually packages everything into one JavaScript file. I was basically able to copy the webpack.config.js and index.ejs from his demo project, place it into Polygram and that would compile. I moved my <a href=https://github.com/mdvanes/polygram/tree/TypeScript>custom elements</a> from the root of the project to the src dir and I had to modify the paths to the bower_components and it would basically work.</p><p>The most important exception is Redux, the redux-mixin.html can&#39;t resolve the PolymerRedux.html dependency (in bower_components/polymer-redux/polymer-redux.html). The polymer-webpack-loader should resolve this, but runtime it logs <code>Uncaught ReferenceError: PolymerRedux is not defined</code>. E.g. for src/polygram-app.html, the loader seems to import the HTML elements that are used in the <code>template</code> element, but not the JavaScript variables that are used in the <code>script</code> element.</p><p>The PolymerRedux code is distributed as JavaScript wrapped in a <code>script</code> tag in mainly one file, so it would be easy to extract it to a JavaScript file. Or even to import <code>polymer-redux/src/index.js</code> instead of <code>polymer-redux/polymer-redux.html</code> (although index.js is uncompiled and misses external dependencies that are not installed in bower_components because they are development dependencies of polymer-redux). For now, I just comment out the Redux dependencies.</p><p>It is already clear now that the result from Webpack will be one huge bundle.js that inlines all JavaScript and HTML dependencies. This means using the <a href=https://www.polymer-project.org/2.0/toolbox/prpl>PRPL pattern</a> will not be possible in this workflow, nor will it be possible to have standalone Polymer components and the accompanying Polymer demo pages.</p><h2>Adding ts-loader</h2><p>Normally, to migrate a Webpack project from JavaScript to TypeScript, it would be enough to add the <a href=https://github.com/TypeStrong/ts-loader>ts-loader</a> to the Webpack config and to rename the JavaScript files to TypeScript files.</p><p>So I started with changing the extension for the bootstrapping index.js and adding .ts as a resolved extension:</p><div class=highlight><pre><code class=language-javascript data-lang=javascript><span class=c1>// webpack.config.js</span>
<span class=p>...</span>
<span class=nl>entry</span><span class=p>:</span> <span class=nx>path</span><span class=p>.</span><span class=nx>resolve</span><span class=p>(</span><span class=nx>__dirname</span><span class=p>,</span> <span class=s1>'src/index.ts'</span><span class=p>),</span>
<span class=p>...</span>
<span class=nl>resolve</span><span class=p>:</span> <span class=p>{</span>
        <span class=nl>extensions</span><span class=p>:</span> <span class=p>[</span><span class=s1>'.ts'</span><span class=p>,</span> <span class=s1>'.js'</span><span class=p>],</span>
<span class=p>...</span>
</code></pre></div><p>And adding this rule:</p><div class=highlight><pre><code class=language-javascript data-lang=javascript><span class=c1>// webpack.config.js</span>
<span class=p>{</span>
    <span class=nl>test</span><span class=p>:</span> <span class=sr>/</span><span class=se>\.</span><span class=sr>ts</span><span class=se>?</span><span class=sr>$/</span><span class=p>,</span>
    <span class=nx>use</span><span class=err>:</span> <span class=p>[</span>
        <span class=p>{</span> <span class=na>loader</span><span class=p>:</span> <span class=s1>'ts-loader'</span> <span class=p>}</span>
    <span class=p>]</span>
<span class=p>}</span>
</code></pre></div><p>And creating a tsconfig.json: <code>javascript { &quot;compilerOptions&quot;: { &quot;sourceMap&quot;: true, } }</code></p><p>Everything still compiles, but the JavaScript for the Polymer components is embedded in the HTML and therefore ignored by the new rule with the ts-loader.</p><p>Adding the ts-loader to the rule for the HTML files breaks compilation:</p><div class=highlight><pre><code class=language-javascript data-lang=javascript><span class=c1>// webpack.config.js</span>
<span class=p>{</span>
    <span class=nl>test</span><span class=p>:</span> <span class=sr>/</span><span class=se>\.</span><span class=sr>html$/</span><span class=p>,</span>
    <span class=nx>use</span><span class=err>:</span> <span class=p>[</span>
        <span class=p>{</span> <span class=na>loader</span><span class=p>:</span> <span class=s1>'babel-loader'</span> <span class=p>},</span>
        <span class=p>{</span> <span class=na>loader</span><span class=p>:</span> <span class=s1>'ts-loader'</span> <span class=p>},</span> <span class=c1>// &lt;--</span>
        <span class=p>{</span> <span class=na>loader</span><span class=p>:</span> <span class=s1>'polymer-webpack-loader'</span> <span class=p>}</span>
    <span class=p>]</span>
<span class=p>},</span>
</code></pre></div><p>Even without changing any of the code itself, compilation fails with:</p><p><code>ERROR in ./src/polygram-app.html Module build failed: Error: Could not find file: &#39;/home/me/polygram/src/polygram-app.html&#39;.</code></p><p>Well, that just doesn&#39;t look healthy. I filed <a href=https://github.com/webpack-contrib/polymer-webpack-loader/issues/64>a bug</a> and almost 2 months after my report the maintainers closed the issue commenting that the root cause is with Webpack, so I don&#39;t see this will be resolved any time soon.</p><p>For now, I will try to work around it by extracting the TypeScript code to a separate file.</p><h3>Workaround for TypeScript compilation in a Polymer element</h3><p>After removing the <code>ts-loader</code> line from the HTML rule in the webpack.config.js I set out to extract the TypeScript to a separate file so it can be compiled with the rule that matches ts files.</p><p>Roughly, the main entry point for the Polymer elements <code>polygram-app.html</code> contains:</p><div class=highlight><pre><code class=language-html data-lang=html>// imports
<span class=nt>&lt;link</span> <span class=na>rel=</span><span class=s>"import"</span> <span class=na>href=</span><span class=s>"../bower_components/polymer/polymer-element.html"</span><span class=nt>&gt;</span>
...
<span class=nt>&lt;link</span> <span class=na>rel=</span><span class=s>"import"</span> <span class=na>href=</span><span class=s>"polygram-details.html"</span><span class=nt>&gt;</span>
<span class=nt>&lt;link</span> <span class=na>rel=</span><span class=s>"import"</span> <span class=na>href=</span><span class=s>"polygram-searchbox.html"</span><span class=nt>&gt;</span>

<span class=nt>&lt;dom-module</span> <span class=na>id=</span><span class=s>"polygram-app"</span><span class=nt>&gt;</span>
    <span class=nt>&lt;template&gt;</span>
        <span class=c>&lt;!-- Style --&gt;</span>
        <span class=nt>&lt;style </span><span class=na>include=</span><span class=s>"iron-flex iron-flex-alignment"</span><span class=nt>&gt;&lt;/style&gt;</span>

        <span class=c>&lt;!-- Markup --&gt;</span>
        <span class=nt>&lt;div</span> <span class=na>class=</span><span class=s>"layout vertical"</span><span class=nt>&gt;</span>
            ...
        <span class=nt>&lt;/div&gt;</span>
        ...
    <span class=nt>&lt;/template&gt;</span>
    <span class=nt>&lt;script&gt;</span>
        <span class=c1>// Script</span>
        <span class=kr>import</span> <span class=nx>format</span> <span class=nx>from</span> <span class=s1>'date-fns/format'</span><span class=p>;</span>

        <span class=kr>class</span> <span class=nx>PolygramApp</span> <span class=kr>extends</span> <span class=nx>Polymer</span><span class=p>.</span><span class=nx>Element</span> <span class=p>{</span>
            <span class=kr>static</span> <span class=nx>get</span> <span class=nx>is</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=s1>'polygram-app'</span><span class=p>;</span> <span class=p>}</span>
            <span class=kr>static</span> <span class=nx>get</span> <span class=nx>properties</span><span class=p>()</span> <span class=p>{</span>
                <span class=k>return</span> <span class=p>{</span>
                    <span class=na>today</span><span class=p>:</span> <span class=p>{</span>
                        <span class=na>type</span><span class=p>:</span> <span class=nb>String</span><span class=p>,</span>
                        <span class=na>value</span><span class=p>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
                            <span class=k>return</span> <span class=nx>format</span><span class=p>(</span><span class=k>new</span> <span class=nb>Date</span><span class=p>(),</span> <span class=s1>'MM/DD/YYYY'</span><span class=p>);</span>
                        <span class=p>}</span>
                    <span class=p>}</span>
                <span class=p>}</span>
            <span class=p>}</span>
        <span class=p>}</span>
        <span class=nb>window</span><span class=p>.</span><span class=nx>customElements</span><span class=p>.</span><span class=nx>define</span><span class=p>(</span><span class=nx>PolygramApp</span><span class=p>.</span><span class=nx>is</span><span class=p>,</span> <span class=nx>PolygramApp</span><span class=p>);</span>
    <span class=nt>&lt;/script&gt;</span>
<span class=nt>&lt;/dom-module&gt;</span>
</code></pre></div><p>Since I know the <code>import</code> statement in the script tag works, I can use this to my advantage. Lets create a companion TypeScript file for polygram-app.html named PolygramApp.ts.</p><div class=highlight><pre><code class=language-typescript data-lang=typescript><span class=c1>// PolygramApp.ts</span>
<span class=k>import</span> <span class=nx>format</span> <span class=k>from</span> <span class=s1>'date-fns/format'</span><span class=p>;</span>

<span class=k>export</span> <span class=k>default</span> <span class=kr>class</span> <span class=nx>PolygramApp</span> <span class=k>extends</span> <span class=nx>Polymer</span><span class=p>.</span><span class=nx>Element</span> <span class=p>{</span>
    <span class=k>static</span> <span class=nx>get</span> <span class=k>is</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=s1>'polygram-app'</span><span class=p>;</span> <span class=p>}</span>
    <span class=k>static</span> <span class=nx>get</span> <span class=nx>properties</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=p>{</span>
            <span class=na>today</span><span class=p>:</span> <span class=p>{</span>
                <span class=na>type</span><span class=p>:</span> <span class=nb>String</span><span class=p>,</span>
                <span class=na>value</span><span class=p>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
                    <span class=k>return</span> <span class=nx>format</span><span class=p>(</span><span class=k>new</span> <span class=nb>Date</span><span class=p>(),</span> <span class=s1>'MM/DD/YYYY'</span><span class=p>);</span>
                <span class=p>}</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>It would be possible to import PolygramApp.ts with <code>&lt;script src=&quot;PolygramApp.ts&quot;&gt;&lt;/script</code>, but I like the standard ES6 module structure of PolygramApp.ts without the added responsibility of registering itself to customElements, so I import it like this:</p><div class=highlight><pre><code class=language-html data-lang=html><span class=c>&lt;!-- polygram-app.html --&gt;</span>
...

<span class=nt>&lt;dom-module</span> <span class=na>id=</span><span class=s>"polygram-app"</span><span class=nt>&gt;</span>
    ...
    <span class=nt>&lt;script&gt;</span>
        <span class=c1>// Script</span>
        <span class=kr>import</span> <span class=nx>PolygramApp</span> <span class=nx>from</span> <span class=s1>'./polygramApp'</span><span class=p>;</span>
        <span class=nb>window</span><span class=p>.</span><span class=nx>customElements</span><span class=p>.</span><span class=nx>define</span><span class=p>(</span><span class=nx>PolygramApp</span><span class=p>.</span><span class=nx>is</span><span class=p>,</span> <span class=nx>PolygramApp</span><span class=p>);</span>
    <span class=nt>&lt;/script&gt;</span>
<span class=nt>&lt;/dom-module&gt;</span>
</code></pre></div><p>The result is a failed compilation with 3 types of errors. Let&#39;s deal with them one by one.</p><h3>1. Failing accessors</h3><p>The <code>is</code> and <code>properties</code> getters require a specifically set target ECMAScript version, the compilation error is: <code>error TS1056: Accessors are only available when targeting ECMAScript 5 and higher</code>. It surprises me that the default ES target is ES3, but it&#39;s not a problem to use ES5 or even ESNext here, because the babel-loader will transpile it back to ES5.</p><p>Adding <code>&quot;target&quot;: &quot;ESNext&quot;</code> to compilerOptions in the tsconfig.json fixes this error.</p><h3>2. Failing Polymer import</h3><p><code>Polymer</code> can&#39;t be found for the <code>extends</code>. This is the most difficult of these errors to solve, because it is caused by the preferred module architecture of Polymer 2: because HTML imports are used, it is not possible to use <code>import Polymer from &#39;../bower_components/polymer/polymer-element.html&#39;</code> because this polymer-element does not export <code>Polymer</code> as an ES6 module. The webpack-polymer-loader can resolve HTML imports, but using <code>import &#39;../bower_components/polymer/polymer-element.html&#39;</code> results in an <code>error TS2304: Cannot find name &#39;Polymer&#39;</code>.</p><p>For the moment, I&#39;m just removing the <code>extends Polymer.Element</code> from PolygramApps.ts and <code>window.customElements.define(PolygramApp.is, PolygramApp);</code> from polygram-app.html.</p><h3>3. Failing date-fns import</h3><p>To be able to continue resolving the compilation errors, I add a log statement to polygram-app.html:</p><div class=highlight><pre><code class=language-html data-lang=html><span class=c>&lt;!-- polygram-app.html --&gt;</span>
...

<span class=nt>&lt;dom-module</span> <span class=na>id=</span><span class=s>"polygram-app"</span><span class=nt>&gt;</span>
    ...
    <span class=nt>&lt;script&gt;</span>
        <span class=c1>// Script</span>
        <span class=kr>import</span> <span class=nx>PolygramApp</span> <span class=nx>from</span> <span class=s1>'./polygramApp'</span><span class=p>;</span>
        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>PolygramApp</span><span class=p>.</span><span class=nx>properties</span><span class=p>.</span><span class=nx>today</span><span class=p>.</span><span class=nx>value</span><span class=p>());</span>
    <span class=nt>&lt;/script&gt;</span>
<span class=nt>&lt;/dom-module&gt;</span>
</code></pre></div><p>The import of date-fns originally failed in the TypeScript compilation with <code>error TS1192: Module &#39;&#39;date-fns/format&#39;&#39; has no default export.</code> but at this point that has two different behaviors:</p><ul><li>The IDE warns <code>TS2307 Cannot find module date-fns</code></li><li>Compilation succeeds, but this error is logged in the browser: <code>Uncaught TypeError: format_1.default is not a function(…)</code></li></ul><p>I first thought that this was caused by missing typings for the date-fns library, so I tried <code>npm install @types/date-fns</code> but this logs that date-fns actually provides typings.</p><p>Eventually I was able to fix the Uncaught TypeError by changing the import in PolygramApp.ts from</p><div class=highlight><pre><code class=language-javascript data-lang=javascript><span class=kr>import</span> <span class=nx>format</span> <span class=nx>from</span> <span class=s1>'date-fns/format'</span><span class=p>;</span>
</code></pre></div><p>to</p><div class=highlight><pre><code class=language-javascript data-lang=javascript><span class=kr>import</span> <span class=p>{</span> <span class=nx>format</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>'date-fns'</span><span class=p>;</span>
</code></pre></div><p>And the IDE warning by adding <code>&quot;moduleResolution&quot;: &quot;node&quot;</code> to the compilerOptions in tsconfig.json.</p><p>At this point, although nothing is rendered, because of the added log statement the current date is logged to the browser console.</p><h3>Failing Polymer import, continued</h3><p>Now the import succeeds and it is clear that the TypeScript compiler correctly processes PolygramApp.ts, it is time to try to fix the import of the <code>Polymer</code> module in PolygramApp.ts.</p><p>A possible workaround will be to not try to import HTML imports in the TypeScript file, but instead to supply those dependencies through the HTML that is importing the TypeScript file. To do this, I change the respective files to:</p><div class=highlight><pre><code class=language-html data-lang=html><span class=c>&lt;!-- polygram-app.html --&gt;</span>
...

<span class=nt>&lt;dom-module</span> <span class=na>id=</span><span class=s>"polygram-app"</span><span class=nt>&gt;</span>
    ...
    <span class=nt>&lt;script&gt;</span>
        <span class=c1>// Script</span>
        <span class=kr>import</span> <span class=nx>PolygramAppFactory</span> <span class=nx>from</span> <span class=s1>'./PolygramApp'</span><span class=p>;</span>
        <span class=kr>const</span> <span class=nx>PolygramApp</span> <span class=o>=</span> <span class=nx>PolygramAppFactory</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=nx>Polymer</span><span class=p>);</span>
        <span class=nb>window</span><span class=p>.</span><span class=nx>customElements</span><span class=p>.</span><span class=nx>define</span><span class=p>(</span><span class=nx>PolygramApp</span><span class=p>.</span><span class=nx>is</span><span class=p>,</span> <span class=nx>PolygramApp</span><span class=p>);</span>
    <span class=nt>&lt;/script&gt;</span>
<span class=nt>&lt;/dom-module&gt;</span>
</code></pre></div><div class=highlight><pre><code class=language-typescript data-lang=typescript><span class=c1>// PolygramApp.ts</span>
<span class=k>import</span> <span class=p>{</span> <span class=nx>format</span> <span class=p>}</span> <span class=k>from</span> <span class=s1>'date-fns'</span><span class=p>;</span>
<span class=kd>const</span> <span class=nx>label</span><span class=err>:</span> <span class=kr>string</span> <span class=o>=</span> <span class=s1>'Current Date: '</span><span class=p>;</span>

<span class=kd>function</span> <span class=nx>create</span><span class=p>(</span><span class=nx>Polymer</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=kr>class</span> <span class=nx>PolygramApp</span> <span class=k>extends</span> <span class=nx>Polymer</span><span class=p>.</span><span class=nx>Element</span> <span class=p>{</span>
        <span class=k>static</span> <span class=nx>get</span> <span class=k>is</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=s1>'polygram-app'</span><span class=p>;</span> <span class=p>}</span>
        <span class=k>static</span> <span class=nx>get</span> <span class=nx>properties</span><span class=p>()</span> <span class=p>{</span>
            <span class=k>return</span> <span class=p>{</span>
                <span class=na>today</span><span class=p>:</span> <span class=p>{</span>
                    <span class=na>type</span><span class=p>:</span> <span class=nb>String</span><span class=p>,</span>
                    <span class=na>value</span><span class=p>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
                        <span class=k>return</span> <span class=nx>label</span> <span class=o>+</span> <span class=nx>format</span><span class=p>(</span><span class=k>new</span> <span class=nb>Date</span><span class=p>(),</span> <span class=s1>'YYYY-MM-DD'</span><span class=p>);</span>
                    <span class=p>}</span>
                <span class=p>}</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>

<span class=k>export</span> <span class=k>default</span> <span class=p>{</span> <span class=nx>create</span> <span class=p>}</span>
</code></pre></div><p>Now everything compiles without errors and the custom elements are rendered again!</p><p>Note here that I also added a <code>string</code> type to <code>const label</code> to see if typings work.</p><h3>Re-enabling Redux</h3><p>Earlier, Redux was disabled to test Webpack. It was failing with the runtime error <code>Uncaught ReferenceError: PolymerRedux is not defined</code> To re-enable it, I convert the <code>polymer-redux/polymer-redux.html</code> from bower_components to a local PolymerRedux.js, by just removing the <code>script</code> tags.</p><p>Because redux-mixin.html, action.html, and reducer.html actually are already JavaScript wrapped in <code>script</code> tags, I just convert them to TypeScript files, for example:</p><div class=highlight><pre><code class=language-typescript data-lang=typescript><span class=c1>// ReduxMixin.ts</span>
<span class=k>import</span> <span class=p>{</span><span class=nx>combineReducers</span><span class=p>,</span> <span class=nx>compose</span><span class=p>,</span> <span class=nx>createStore</span><span class=p>}</span> <span class=k>from</span> <span class=s1>'redux'</span><span class=p>;</span>
<span class=kd>const</span> <span class=nx>PolymerRedux</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>'exports-loader?PolymerRedux!./PolymerRedux'</span><span class=p>);</span>
<span class=p>...</span>
<span class=k>export</span> <span class=kd>const</span> <span class=nx>ReduxMixin</span> <span class=o>=</span> <span class=nx>PolymerRedux</span><span class=p>(</span><span class=nx>reduxStore</span><span class=p>);</span>
</code></pre></div><p>To use it in PolygramApp.ts, it can now be imported like a normal ES6 module:</p><div class=highlight><pre><code class=language-typescript data-lang=typescript><span class=c1>// PolygramApp.ts</span>
<span class=k>import</span> <span class=p>{</span> <span class=nx>format</span> <span class=p>}</span> <span class=k>from</span> <span class=s1>'date-fns'</span><span class=p>;</span>
<span class=kd>const</span> <span class=nx>label</span><span class=err>:</span> <span class=kr>string</span> <span class=o>=</span> <span class=s1>'Current Date: '</span><span class=p>;</span>
<span class=k>import</span> <span class=p>{</span><span class=nx>ReduxMixin</span><span class=p>,</span> <span class=nx>reduxStore</span><span class=p>}</span> <span class=k>from</span> <span class=s1>'./ReduxMixin'</span><span class=p>;</span>

<span class=kd>function</span> <span class=nx>create</span><span class=p>(</span><span class=nx>Polymer</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=kr>class</span> <span class=nx>PolygramApp</span> <span class=k>extends</span> <span class=nx>ReduxMixin</span><span class=p>(</span><span class=nx>Polymer</span><span class=p>.</span><span class=nx>Element</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>static</span> <span class=nx>get</span> <span class=k>is</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=s1>'polygram-app'</span><span class=p>;</span> <span class=p>}</span>

        <span class=k>static</span> <span class=nx>get</span> <span class=nx>properties</span><span class=p>()</span> <span class=p>{</span>
            <span class=c1>// Added Redux code here</span>
            <span class=p>...</span>
        <span class=p>}</span>

        <span class=nx>ready</span><span class=p>()</span> <span class=p>{</span>
            <span class=c1>// Added Redux code here</span>
            <span class=p>...</span>
        <span class=p>}</span>

    <span class=p>}</span>
<span class=p>}</span>

<span class=k>export</span> <span class=k>default</span> <span class=p>{</span> <span class=nx>create</span> <span class=p>}</span>
</code></pre></div><p>After making similar modifications for polygram-searchbox, the Redux events work again as before introducing TypeScript.</p><h2>Importing a global variable from HTML</h2><p>At this point PolymerRedux is loaded from a custom PolymerRedux.js that I made in the previous step by removing the <code>&lt;script&gt;</code> tags from the file in bower_components. Although this works, it would be better to use the file in bower_components directly because it will be easier to handle updates to this external package.</p><p>Currently I import the custom PolymerRedux.js in state/ReduxMixin.ts with:</p><div class=highlight><pre><code class=language-typescript data-lang=typescript><span class=kd>const</span> <span class=nx>PolymerRedux</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>'exports-loader?PolymerRedux!./PolymerRedux'</span><span class=p>);</span>
</code></pre></div><p>To load the HTML from the bower_components, I expect to have to use the polymer-webpack-loader to extract the JavaScript from the <code>script</code> tags:</p><div class=highlight><pre><code class=language-typescript data-lang=typescript><span class=kd>const</span> <span class=nx>PolymerRedux</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>'exports-loader?PolymerRedux!polymer-webpack-loader!../../bower_components/polymer-redux/dist/polymer-redux.html'</span><span class=p>);</span>
</code></pre></div><p>This fails to compile with the message that PolymerRedux is undefined, so I add the <a href=https://github.com/ianwalter/debug-loader>debug-loader</a> to investigate what the result of each step looks like:</p><div class=highlight><pre><code class=language-typescript data-lang=typescript><span class=kd>const</span> <span class=nx>PolymerRedux</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>'exports-loader?PolymerRedux!polymer-webpack-loader!debug-loader?id=raw!../../bower_components/polymer-redux/dist/polymer-redux.html'</span><span class=p>);</span>
</code></pre></div><p>Thanks to debug-loader it is immediately clear that already before going into the polymer-webpack-loader the <code>script</code> tags have been stripped. Just using require without any loaders turns something likes this <code>&lt;script&gt;foo()&lt;/script&gt;</code> into <code>foo()</code> and webpack-polymer-loader is not needed in this case. I do think this only works when the file is completely self contained and does not have dependencies with other Polymer HTML files.</p><p>This is the final working import:</p><div class=highlight><pre><code class=language-typescript data-lang=typescript><span class=kd>const</span> <span class=nx>PolymerRedux</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>'exports-loader?PolymerRedux!../../bower_components/polymer-redux/dist/polymer-redux.html'</span><span class=p>);</span>
</code></pre></div><h2>Linting</h2><p>Although there is a <a href=https://github.com/Polymer/polymer-linter>polymer-linter</a>, it is <a href=https://github.com/Polymer/polymer-linter#use-with-other-tools>advised</a> to use Polymer Linter combined with other linters, and an obvious choice is TSLint.</p><p>The way that TSLint is configured with Webpack means that it will only lint TypeScript that is not embedded in HTML:</p><div class=highlight><pre><code class=language-javascript data-lang=javascript><span class=c1>// webpack.config.js</span>
<span class=k>new</span> <span class=nx>TSLintPlugin</span><span class=p>({</span>
    <span class=na>files</span><span class=p>:</span> <span class=p>[</span><span class=s1>'./src/**/*.ts'</span><span class=p>]</span> <span class=c1>// So, this requires none of the TS to be inline in HTML?</span>
<span class=p>})</span>
</code></pre></div><p>Before I started with this experiment I thought this might be a problem. But now almost all script has been extracted to separate TypeScript files anyway, so this works quite well.</p><p>Of course it is also still possible to run TSLint manually for a file, e.g. <code>./node_modules/.bin/tslint --config tslint.json polygram-marvel-details.ts</code></p><p>It is still required to run <code>polymer lint</code> manually. As far as I know there is no integration for Webpack yet.</p><h2>Decorators</h2><p>I want to see if I can use <a href=https://medium.com/google-developers/exploring-es7-decorators-76ecb65fb841>ES decorators</a>, because decorators conceptually fit with the Mixin pattern used in Polymer for e.g. <code>class MyElement extends ReduxMixin(Polymer.Element)</code>. It would be tidy if we could write this as a decorator, especially if more mixins would need to be combined:</p><div class=highlight><pre><code class=language-typescript data-lang=typescript><span class=err>@</span><span class=nx>ReduxMixin</span>
<span class=kr>class</span> <span class=nx>MyElement</span> <span class=k>extends</span> <span class=nx>Polymer</span><span class=p>.</span><span class=nx>Element</span>
<span class=p>...</span>
</code></pre></div><p>As a test, I just add an <a href=https://medium.com/google-developers/exploring-es7-decorators-76ecb65fb841>example decorator</a> to the class in polygram-details.ts:</p><div class=highlight><pre><code class=language-typescript data-lang=typescript>    <span class=err>@</span><span class=k>readonly</span>
    <span class=nx>foo</span><span class=p>()</span> <span class=p>{</span>
        <span class=c1>// This works, but prepends a polyfill to the output</span>
        <span class=k>return</span> <span class=s1>'just testing a decorator'</span><span class=p>;</span>
    <span class=p>}</span>
</code></pre></div><p>And in the same file, but outside the class, the definition of the decorator:</p><div class=highlight><pre><code class=language-typescript data-lang=typescript><span class=kd>function</span> <span class=k>readonly</span><span class=p>(</span><span class=nx>target</span><span class=p>,</span> <span class=nx>key</span><span class=p>,</span> <span class=nx>descriptor</span><span class=p>)</span> <span class=p>{</span>
    <span class=nx>descriptor</span><span class=p>.</span><span class=nx>writable</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
    <span class=k>return</span> <span class=nx>descriptor</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div><p>The compiler fails with: <code>error TS1219: Experimental support for decorators is a feature that is subject to change in a future release. Set the &#39;experimentalDecorators&#39; option to remove this warning.</code></p><p>This flag can be added to the compilerOptions section of the tsconfig.json: <code>&#39;experimentalDecorators&#39;: true</code>. The compilation now succeeds, but prepends a small polyfill for <code>decorator</code> to the output. Take this into account when using decorator in many files, because it will cause an overhead that might be avoided by using a third party library that is imported globally.</p><h2>App vs Element</h2><p>It is one thing to compile Typescript for a Polymer app, but another thing to use TypeScript for reusable Polymer components.</p><p>The next step will be to compile the Polymer components in this test project separately. As a result, each converted component should both be loaded into its own <a href=https://github.com/PolymerElements/iron-component-page>demo page</a> and to be composed into a Polymer app.</p><p>The demo pages should be accessible by running <code>polymer serve</code>, conform the normal Polymer workflow.</p><p>When just running a Webpack build for the current project with <code>./node_modules/.bin/webpack --config webpack.config.js</code>, it will build a <code>dist</code> dir containing amongst others an index.html and a bundle.js. This is a standalone app, but this would not be a good workflow to distribute a Polymer component because:</p><ul><li>the index.html is a complete HTML document, not just a <code>dom-module</code></li><li>the bundle.js is one huge JavaScript blob that contains not only the compiled JavaScript for the component, but also all templates, TypeScript, Webpack and Polymer polyfills and libraries (like lodash in this case)</li></ul><p>The polyfills and libraries need to be kept separate, so that they can be loaded once per project instead of once for every component. The bundle.js is already 2.8MB in size (unminified) / 347kB (minified).</p><p>Would it be possible to make a Polymer component that uses the <code>&lt;script src=&quot;foo.js&quot;&gt;</code> style import and then do a &quot;naive&quot; compilation from foo.ts to foo.js? Let&#39;s first make a minimal example where the JavaScript is extracted from an Polymer component:</p><ul><li>Using <code>/polygram-details.html</code> (this is the original, that the TypeScript+Webpack version in /src/ was based on) and <code>/demo/polygram-details</code> (already importing /polygram-details)</li><li>Do not run webpack, but just <code>polymer serve</code> and test the demo page</li><li>Replace <code>&lt;script&gt;... code ...&lt;/script&gt;</code> by <code>&lt;script src=&quot;polygram-details.js&quot;&gt;&lt;/script&gt;</code>, extract the JavaScript to polygram-details.js and test the demo page again: this works.</li></ul><p>Now to TypeScript:</p><ul><li>Rename <code>polygram-detail.js</code> but leave the reference in <code>polygram-details.html</code> to point to the JavaScript version: <code>&lt;script src=&quot;polygram-details.js&quot;&gt;&lt;/script&gt;</code></li><li>The package <code>typescript</code> was already installed as a dependency, so use <code>tsc</code>: <code>./node_modules/.bin/tsc polygram-details.ts</code>. This gives errors, but does generate code. The resulting code does not run.</li></ul><p>The first errors are:</p><div class=highlight><pre><code class=language- data-lang="">polygram-details.ts(8,31): error TS2304: Cannot find name 'Polymer'.
polygram-details.ts(33,14): error TS2339: Property '_searchResult' does not exist on type 'PolygramDetails'.
polygram-details.ts(35,18): error TS2339: Property '_searchIAUrl' does not exist on type 'PolygramDetails'.
polygram-details.ts(42,18): error TS2339: Property '_searchResult' does not exist on type 'PolygramDetails'.
</code></pre></div><p>Adding <code>declare const Polymer: any;</code> fixes these 4 errors. It tells TypeScript a global variable <code>Polymer</code> can be expected.</p><p>This leaves the following errors:</p><div class=highlight><pre><code class=language- data-lang="">polygram-details.ts(9,16): error TS1056: Accessors are only available when targeting ECMAScript 5 and higher.
polygram-details.ts(13,16): error TS1056: Accessors are only available when targeting ECMAScript 5 and higher.
</code></pre></div><p>The current compilation seems to ignore the tsconfig.json, because a similar error was solved earlier by adding <code>&quot;target&quot;: &quot;ESNext&quot;</code> in the config. The target can be specified with a flag: <code>./node_modules/.bin/tsc --target ES6 polygram-details.ts</code>. This runs without errors and works in the browser!</p><h3>Simple compilation and Webpack</h3><p>This much simpler approach without Webpack seems to provide a more realistic workflow. Can we afford to leave Webpack out entirely? Let&#39;s reiterate its purpose:</p><h4>Webpack transpiles to ES5 with Babel</h4><p>As mentioned before we don&#39;t need Babel for transpilation, the TypeScript compiler can be set to ES6 or ES5.</p><h4>Webpack provides a development server with hot module reloading</h4><p>Hot Module Replacement is mainly to ease development, but we can use livereload combined with polyserve instead which would be acceptable for this use case.</p><h4>Webpack handles module bundling</h4><p>We can do without ES6 modules or packaging other resources like images as JavaScript modules, because we already have to deal with Polymer Elements as a component platform. We have to distribute the end result as Polymer Elements to be able to add it to the catalog.</p><p>Although Polymer 3 will use ES6 modules, a tool is supposed to become available that can migrate from elements from Polymer 2 to Polymer 3 syntax.</p><p>Without Webpack we lose the module polyfill that is injected per file, which potentially saves a significant size overhead, whilst staying closer to the concept of Polymer Element development.</p><p>Global JavaScript variables from external modules can be made accessible with the <code>declare</code> placeholder, and it is still possible to use <code>import</code> to import from <code>node_modules</code>. However, when module is set to <code>none</code> in the tsconfig.json, the variable will just be put onto the &quot;global&quot; scope. This is not the <em>true</em> global scope, because it is still contained within the Polymer element, so the variable will be on the Polymer Element scope, and should not leak to the actual global scope.</p><p><code>Import</code> should still be used with caution: it will lead to code duplication if 2 Polymer+TypeScript elements import the same dependency. In that case it would be better to import that dependency via HTML import because the Polymer compiler can deduplicate it.</p><p>Webpack can also be used to package CSS as modules, but for encapsulating CSS in Polymer the <a href=https://developer.mozilla.org/en-US/docs/Web/Web_Components/Shadow_DOM>Shadow DOM</a> can be used. This is actually an aspect of web components that is very well executed.</p><h3>Automatic compilation</h3><p>Without Webpack, it is unpractical that for every change to a TypeScript file a manual transformation is needed. Following the example in the previous section, each time <code>polygram-details.ts</code> changes, <code>./node_modules/.bin/tsc --target ES6 polygram-details.ts</code> must be run. Let&#39;s try to automate this without using Webpack.</p><h4>With tsc</h4><p>First I make a new tsconfig named <code>tsconfig.inline.json</code> for this use case:</p><div class=highlight><pre><code class=language-json data-lang=json><span class=p>{</span><span class=w>
  </span><span class=nt>"compilerOptions"</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
    </span><span class=nt>"sourceMap"</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span><span class=w>
    </span><span class=nt>"target"</span><span class=p>:</span><span class=w> </span><span class=s2>"ES6"</span><span class=w>
  </span><span class=p>},</span><span class=w>
  </span><span class=nt>"include"</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w>
    </span><span class=s2>"*.ts"</span><span class=w>
  </span><span class=p>]</span><span class=w>
</span><span class=p>}</span><span class=w>
</span></code></pre></div><p>To compile run <code>./node_modules/.bin/tsc -w -p tsconfig.inline.json</code>. The <code>-w</code> flag keeps the process running and watches for changes in the included TypeScript files.</p><p>An interesting side-effect occurs. Naturally, each TypeScript file is going to need the <code>declare const Polymer: any;</code> declaration as a workaround for the fact that the Polymer dependency can&#39;t be imported (see previous sections). But because we now use <code>-p</code>, the project flag, the compiler expects all files share global scope. And the second file using <code>declare const Polymer: any;</code> will get an error: <code>Cannot redeclare block-scoped variable &#39;Polymer&#39;</code>. How can we use the project flag, without letting the compiler share the global scope between all TypeScript files?</p><p>A workaround would be to create a TypeScript file that just imports/declares all the expected global variables once. This would make the code less transparent at best and it might even create other scoping issues.</p><h3>Custom compilation</h3><p>As an alternative let&#39;s try to run compilation with an isolated scope for each TypeScript file. <a href=https://github.com/Microsoft/TypeScript/issues/1516>This issue</a> explains that this would be possible by supplying a tsconfig.json for each scope. That would be doable for a limited set of scopes that is static over time (e.g. a back-end codebase and a front-end codebase in the same project). However, it makes no sense from a maintenance standpoint for the current project as it would need a tsconfig.json for each Polymer element.</p><p>To be complete, I did try this out. First, set up a base tsconfig that can be inherited:</p><div class=highlight><pre><code class=language-json data-lang=json><span class=err>//</span><span class=w> </span><span class=err>base.json</span><span class=w>
</span><span class=p>{</span><span class=w>
  </span><span class=nt>"compilerOptions"</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
    </span><span class=nt>"sourceMap"</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span><span class=w>
    </span><span class=nt>"target"</span><span class=p>:</span><span class=w> </span><span class=s2>"ESNext"</span><span class=p>,</span><span class=w>
    </span><span class=nt>"moduleResolution"</span><span class=p>:</span><span class=w> </span><span class=s2>"node"</span><span class=p>,</span><span class=w>
    </span><span class=nt>"experimentalDecorators"</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
  </span><span class=p>}</span><span class=w>
</span><span class=p>}</span><span class=w>
</span></code></pre></div><p>Now for each Polymer TypeScript file a tsconfig, e.g.:</p><div class=highlight><pre><code class=language-json data-lang=json><span class=err>//</span><span class=w> </span><span class=err>polygram-details.tsconfig.json</span><span class=w>
</span><span class=p>{</span><span class=w>
  </span><span class=nt>"extends"</span><span class=p>:</span><span class=w> </span><span class=s2>"./base.json"</span><span class=p>,</span><span class=w>
  </span><span class=nt>"files"</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w>
    </span><span class=s2>"./polygram-details.ts"</span><span class=w>
  </span><span class=p>]</span><span class=w>
</span><span class=p>}</span><span class=w>
</span></code></pre></div><p>It is now possible to compile/watch polygram-details.ts with <code>tsc -w -p polygram-details.tsconfig.json</code>, but it is still not possible to compile/watch multiple tsconfigs at <em>the same time</em>.</p><p>In this case it would be better to forget about the watch flag <code>-w</code> altogether and just use <code>npm watch</code> combined with <code>tsc [changedfile]</code>. You can&#39;t use a tsconfig.json combined with an input file path for tsc, so all options must be supplied as flags: <code>tsc --target ES6 --sourceMap [changedFile]</code>.</p><p>I tried combining this compilation one-liner with a watch script, but I could not get this to work with <a href=https://www.npmjs.com/package/nodemon>nodemon</a>, <a href=https://www.npmjs.com/package/npm-watch>npm-watch</a> or <a href=https://www.npmjs.com/package/watch>watch</a>, so I wrote a small script:</p><div class=highlight><pre><code class=language-javascript data-lang=javascript><span class=c1>// ts-poly-watch.js, run with: node ts-poly-watch.js</span>
<span class=kr>const</span> <span class=nx>watch</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>'watch'</span><span class=p>);</span>
<span class=kr>const</span> <span class=nx>path</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>'path'</span><span class=p>);</span>
<span class=kr>const</span> <span class=nx>chalk</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>'chalk'</span><span class=p>);</span>
<span class=kr>const</span> <span class=nx>tsc</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>'node-typescript-compiler'</span><span class=p>);</span>

<span class=nx>watch</span><span class=p>.</span><span class=nx>createMonitor</span><span class=p>(</span><span class=nx>__dirname</span><span class=p>,</span> <span class=p>{</span> <span class=na>interval</span><span class=p>:</span> <span class=mi>1</span> <span class=p>},</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>monitor</span><span class=p>)</span> <span class=p>{</span>
    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>chalk</span><span class=p>.</span><span class=nx>gray</span><span class=p>.</span><span class=nx>bgGreen</span><span class=p>.</span><span class=nx>bold</span><span class=p>(</span><span class=s1>'TS-POLY-WATCH started'</span><span class=p>));</span>
    <span class=nx>monitor</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>'changed'</span><span class=p>,</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>f</span><span class=p>,</span> <span class=nx>curr</span><span class=p>,</span> <span class=nx>prev</span><span class=p>)</span> <span class=p>{</span>
        <span class=kr>const</span> <span class=nx>ext</span> <span class=o>=</span> <span class=nx>path</span><span class=p>.</span><span class=nx>extname</span><span class=p>(</span><span class=nx>f</span><span class=p>);</span>
        <span class=k>if</span><span class=p>(</span><span class=nx>ext</span> <span class=o>===</span> <span class=s1>'.ts'</span><span class=p>)</span> <span class=p>{</span>
            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>f</span> <span class=o>+</span> <span class=s1>' changed'</span><span class=p>);</span>
            <span class=nx>tsc</span><span class=p>.</span><span class=nx>compile</span><span class=p>(</span>
                <span class=p>{</span>
                    <span class=s1>'target'</span><span class=p>:</span> <span class=s1>'ES6'</span><span class=p>,</span>
                    <span class=s1>'sourceMap'</span><span class=p>:</span> <span class=kc>true</span>
                <span class=p>},</span>
                <span class=nx>f</span>
            <span class=p>);</span>
        <span class=p>}</span>
    <span class=p>});</span>
<span class=p>});</span>
</code></pre></div><p>Now it is possible to watch each TypeScript file and compile it with its scope isolated from the other TypeScript files.</p><h2>twc</h2><p>With <code>ts-poly-watch.js</code> it looks like we finally have an acceptable working environment. I have extracted the script to its own project <a href=https://github.com/mdvanes/typescript-batch-compiler>typescript-batch-compiler</a> and <a href=https://www.npmjs.com/package/typescript-batch-compiler>npm package</a> because there is much room for improvement and it will be easier to use in other projects if it is an npm package.</p><p>So are we now done? In fact there is one more thing I want to explore. During the research I ran into <a href=https://github.com/Draccoz/twc>twc</a>. This is a compiler for <em>TypeScript Web Components</em> and can be used to compile TypeScript classes to Polymer 2 elements. Although this sounds like it is similar to my <code>typescript-batch-compiler</code>, here are some preliminary findings:</p><ol><li>It assumes a TypeScript file as the entrypoint: in my setup I still stay close to the Polymer setup with a Polymer element (so HTML) that includes a script file. With <code>twc</code> the entrypoint is a TypeScript file that imports an HTML template. A great advantage is that this is more like Polymer 3 and also similar to other component driven frameworks like React, Vue and Angular. The disadvantage is of course that the style will be foreign to other Polymer developers.</li><li>It&#39;s still very experimental. There is no example in the repo or an explanation of how to set up a basic element in the README, but a general approach is outlined <a href=https://github.com/Draccoz/twc/wiki/Creating-a-simple-component>on the project wiki</a> and examples of twc in a project can be found in <a href=https://github.com/mlisook/generator-polymer-init-twc-starter-kit>this generator project</a>.</li></ol><p>With the aforementioned wiki, I take these steps:</p><ul><li>Run <code>twc</code> in a new subdir of the project appropriately named &quot;twc&quot;</li><li>Set up a very basic polygram-twc.ts conforming to the style as outlined in the wiki:</li></ul><div class=highlight><pre><code class=language-typescript data-lang=typescript><span class=c1>// polygram-twc.ts</span>
<span class=k>import</span> <span class=p>{</span> <span class=nx>CustomElement</span> <span class=p>}</span> <span class=k>from</span> <span class=s1>'twc/polymer'</span><span class=p>;</span>
<span class=k>import</span> <span class=s1>'bower:polymer/polymer-element.html'</span><span class=p>;</span>

<span class=cm>/**
 * `online-state`
 * Lets you select an online state (online or offline) and reflect the change on a host attribute.
 *
 * @customElement
 * @polymer
 * @demo demo/index.html
 */</span>
<span class=err>@</span><span class=nx>CustomElement</span><span class=p>()</span>
<span class=kr>class</span> <span class=nx>OnlineState</span> <span class=k>extends</span> <span class=nx>Polymer</span><span class=p>.</span><span class=nx>Element</span> <span class=p>{</span>
    <span class=nl>prop1</span><span class=p>:</span> <span class=kr>string</span> <span class=o>=</span> <span class=s2>"online-state"</span><span class=p>;</span>

    <span class=nx>template</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=err>`</span>
          <span class=o>&lt;</span><span class=nx>style</span><span class=o>&gt;</span>
            <span class=err>:</span><span class=nx>host</span> <span class=p>{</span>
              <span class=nl>display</span><span class=p>:</span> <span class=nx>block</span><span class=p>;</span>
            <span class=p>}</span>
          <span class=o>&lt;</span><span class=sr>/style</span><span class=err>&gt;
</span>          <span class=o>&lt;</span><span class=nx>h2</span><span class=o>&gt;</span><span class=nx>Hello</span> <span class=p>[[</span><span class=nx>prop1</span><span class=p>]]</span><span class=o>!&lt;</span><span class=sr>/h2</span><span class=err>&gt;
</span>        <span class=err>`</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><ul><li>Run <code>tsc --init</code> to create a new tsconfig.json in the twc dir. This turns out to be important. When I re-use my existing tsconfig.json the build fails with <code>Error: Debug Failure.</code>. This seems to be caused by the line <code>&quot;moduleResolution&quot;: &quot;node&quot;</code>, which is not needed for this compilation.</li><li>Add <code>node_modules/twc/types/polymer.decorators.d.ts</code> to the include section of the tsconfig.json, to resolve certain types.</li><li>Build in the twc dir by running <code>../node_modules/.bin/twc polygram-twc.ts</code>.</li><li>A polygram-twc.html is created.</li></ul><p>I also converted the original polygram-details.html (the one with embedded JavaScript) to this format. See the result in <a href=https://github.com/mdvanes/polygram/tree/TypeScript/twc>the repo for this experiment</a>. When working on this conversion, some differences with normal web components become apparent:</p><ul><li>twc auto-injects the registration of the component: <code>customElements.define(PolygramDetails.is, PolygramDetails);</code></li><li><code>import &#39;./polygram-ui-details&#39;;</code> is converted to <code>&lt;link rel=&quot;import&quot; href=&quot;./polygram-ui-details.html&quot;&gt;</code></li><li>the <code>is</code> getter, i.e. this: <code>static get is() { return &#39;polygram-details&#39;; }</code> is auto generated from the class name.</li><li>The JSDoc is converted to an HTML comment.</li></ul><p>This syntax uses plain ES modules and is therefore also closer to Polymer 3. Still there are some differences. Compare the code for polygram-twc.ts but in <a href=https://www.polymer-project.org/blog/2017-08-23-hands-on-30-preview>Polymer 3 syntax</a>:</p><div class=highlight><pre><code class=language-typescript data-lang=typescript><span class=c1>// PolymerElement is its own module now, instead of a property of the Polymer namespace. Also, bower is no longer used.</span>
<span class=k>import</span> <span class=p>{</span> <span class=nx>Element</span> <span class=k>as</span> <span class=nx>PolymerElement</span> <span class=p>}</span> <span class=k>from</span> <span class=s1>'@polymer/polymer/polymer-element'</span><span class=p>;</span>

<span class=c1>// Aside from inline templates, this syntax can be used too:</span>
<span class=c1>//import * as view from './app.template.html';</span>

<span class=k>export</span> <span class=kr>class</span> <span class=nx>OnlineState</span> <span class=k>extends</span> <span class=nx>PolymerElement</span> <span class=p>{</span>
    <span class=kd>constructor</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>super</span><span class=p>();</span>
        <span class=c1>// Property must be defined in the constructor, but this might be a difference with TypeScript and not Polymer 3.</span>
        <span class=k>this</span><span class=p>.</span><span class=nx>prop1</span> <span class=o>=</span> <span class=s1>'online-state'</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=k>static</span> <span class=nx>get</span> <span class=nx>template</span><span class=p>()</span> <span class=p>{</span>
        <span class=c1>// I don't know where the &lt;style&gt; element should go.</span>
        <span class=k>return</span> <span class=err>`</span><span class=o>&lt;</span><span class=nx>h2</span><span class=o>&gt;</span><span class=nx>Hello</span> <span class=p>[[</span><span class=nx>prop1</span><span class=p>]]</span><span class=o>!&lt;</span><span class=sr>/h2&gt;`</span><span class=err>;
</span>        <span class=c1>// Or when using an import:</span>
        <span class=c1>//return view;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>Although I can&#39;t find any sources, I heard that Polymer 3 would supply an auto converter from (normal) Polymer 2 syntax. You could use that converter on the output of twc, so this should not be a reason to avoid twc.</p><h2>Final remarks</h2><p>Unit testing and coverage support when using TypeScript has not been mentioned, but I hope it is clear that it is unchanged from a normal Polymer 2 application when using typescript-batch-compiler. You can just use <a href=https://github.com/Polymer/web-component-tester>WCT</a>), because all components are compiled to a state that conforms to a non-TypeScript Polymer 2 situation.</p><p>For the Webpack approach it would be an improvement to see why <code>polymer-webpack-loader</code> is not importing Polymer when using <code>import Polymer from &#39;../bower_components/polymer/polymer-element.html&#39;</code> or <code>import &#39;../bower_components/polymer/polymer-element.html&#39;</code>.</p><p>It could also be an improvement to add the <a href=https://www.npmjs.com/package/tslint-plugin-prettier>prettier</a> plugin to promote a consistent coding style. This could be added to TSLint via Webpack, but could also be integrated in the typescript-batch-compiler package.</p></div></div><div class="modal fade modal-terminal" id=contactModal tabindex=-1 role=dialog aria-labelledby=contactModalLabel aria-hidden=true><div class=modal-dialog><div class=modal-content><div class=modal-header><button type=button class=close data-dismiss=modal><span aria-hidden=true>&times;</span><span class=sr-only>Close</span></button><h4 class=modal-title id=myModalLabel>contact@mdworld</h4></div><div class=modal-body><form role=form id=contactForm><div class=form-group><label for=contactName>Name</label><input class=form-control id=contactName placeholder="Enter name" name=name required maxlength=1024></div><div class=form-group><label for=contactEmail>Email address</label><input type=email class=form-control id=contactEmail placeholder="Enter email" name=email required maxlength=1024></div><div class=form-group><label for=contactMessage>Message</label><textarea class=form-control id=contactMessage placeholder=Message name=message required maxlength=4096></textarea></div><button type=button class="btn btn-primary submit-contact">Submit</button></form></div></div></div></div><footer><div class="content container"><div class="row projects"><div class="col-xs-12 col-xl-4 col-xl-offset-2"><h2>Open Source by MDWorld</h2></div></div><div class="row projects"><div class="col-xs-12 col-sm-6 col-xl-4 col-xl-offset-2"><div class=media-wrapper><a class=media href=https://github.com/mdvanes/polygram><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>polygram</h4>Polymer and Redux App</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/mdworld-pwa-demo><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>mdworld-pwa-demo</h4>Progressive Web App demo</div></a></div><div class=media-wrapper><a class=media href=https://bitbucket.org/mdvanes/homeremote><span class="pull-left icon bitbucket"></span><div class=media-body><h4 class=media-heading>HomeRemote</h4>ES6 React and Node Home automation tool</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/generator-mdworld-toolchain><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>generator-mdworld-toolchain</h4>Yeoman generator to set up the mdworld toolchain</div></a></div><div class=media-wrapper><a class=media href=http://mdvanes.github.io/ImpossibleObjects/ ><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>ImpossibleObjects</h4>A selection of impossible objects using Canvas</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/grunt-kot2html><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>grunt-kot2html</h4>Grunt task to combine Knockout templates into one HTML</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/grunt-kot2js><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>grunt-kot2js</h4>Grunt task to convert Knockout templates to a JavaScript file</div></a></div></div><div class="col-xs-12 col-sm-6 col-xl-4"><div class=media-wrapper><a class=media href=https://github.com/mdvanes/mdworld-stox><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>mdworld-stox</h4>Websockets in Node.js demo</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/SynergyChrome><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>SynergyChrome</h4>Use Synergy in Chrome</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/Movienight><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>Movienight</h4>PoC for hybrid app with Ionic Framework</div></a></div><div class=media-wrapper><a class=media href=https://bitbucket.org/mdvanes/mderekelbox><span class="pull-left icon bitbucket"></span><div class=media-body><h4 class=media-heading>Rekelbox</h4>Arduino VU meter</div></a></div><div class=media-wrapper><a class=media href=https://bitbucket.org/mdvanes/mdepolska><span class="pull-left icon bitbucket"></span><div class=media-body><h4 class=media-heading>MDE Polska</h4>Polish keyboard Drupal module</div></a></div><div class=media-wrapper><a class=media href=https://bitbucket.org/mdvanes/mdegraph><span class="pull-left icon bitbucket"></span><div class=media-body><h4 class=media-heading>MDE Graph</h4>Javascript Graph PoC</div></a></div><div class=media-wrapper><a class=media href=https://bitbucket.org/mdvanes/mdeinsignificant><span class="pull-left icon bitbucket"></span><div class=media-body><h4 class=media-heading>Insignificant!</h4>loltext generator Drupal module</div></a></div></div></div><div class=row><h1 class=dedication>an MDWorld production</h1><p><a class=cc href=http://creativecommons.org/licenses/by-nc-sa/3.0/ title="Creative Commons">CC</a> 2003-2018</p></div></div></footer></div><!-- .site --><script src=/mdworld-ingram/js/scripts.js></script><!-- Run init for demo after loading jquery --><script>if(typeof(demoInit) === 'function') {
                demoInit();
            }</script></body></html>