<!DOCTYPE html><!--[if lt IE 9]> <html class="lt-ie9" lang="en"> <![endif]--><!--[if IE 9]>    <html class="ie9" lang="en"> <![endif]--><!--[if gt IE 9]><!--><html xmlns=http://www.w3.org/1999/xhtml class=gt-ie9 lang=en><!--<![endif]--><head><!-- version 0.3.5 --><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=author content="mdworld 0.3.5"><title>Reducing complexity...</title><link rel="shortcut icon" href=/blog/img/favicon.ico type=image/x-icon><link rel=stylesheet href=/blog/css/all.css></head><body><div class=site><nav class="navbar navbar-inverse navbar-fixed-top"><div><div class=container><div class=row><ul class="nav navbar-nav navbar-right"><li><a href=/blog/ ><span class="glyphicon glyphicon-home"></span> home</a></li><li><a href=/blog/#blog><span class="glyphicon glyphicon-pencil"></span> blog</a></li><li><a href=https://twitter.com/mdworldNL><span class=twitter></span> <span class=label-optional>@mdworldNL</span></a></li><li><a href=# data-toggle=modal data-target=#contactModal><span class="glyphicon glyphicon-envelope"></span> <span class=label-optional>contact</span></a></li></ul></div></div></div><header><h1 class="title post-title container">Reducing complexity...</h1></header></nav><p class="meta container">02 Oct 2017</p><div class="post container"><div class=multi-column-text><h1>Reducing cyclomatic complexity with functional operators</h1><p>Reducing the cyclomatic complexity in a JavaScript application is a good, <a href=https://eslint.org/docs/rules/complexity>quantifiable</a> way to make code more readable and maintainable.</p><p>Cyclomatic complexity increases as more control statements are used. For a summary of the factors that influence complexity, see <a href=https://craftsmanshipforsoftware.com/2015/05/25/complexity-for-javascript/ >&quot;Complexity for JavaScript&quot;</a>. Because it is quantifiable, it can be automatically validated in build setups with <a href=https://eslint.org/docs/rules/complexity>eslint</a>. Bear in mind that a single <code>switch</code> statement with a large amount of options will have a high cyclomatic complexity but probably is still perfectly readable. As always, rely on common sense when refactoring.</p><p>Control statements that concern one parameter often use <code>switch</code>, for example:</p><div class=highlight><pre><code class=language-javascript data-lang=javascript><span class=kr>const</span> <span class=nx>foo</span> <span class=o>=</span> <span class=s1>'banana'</span><span class=p>;</span>
<span class=k>switch</span> <span class=p>(</span><span class=nx>foo</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>case</span> <span class=s1>'apple'</span><span class=err>:</span>
        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>'First'</span><span class=p>);</span>
        <span class=k>break</span><span class=p>;</span>
    <span class=k>case</span> <span class=s1>'banana'</span><span class=err>:</span>
        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>'Second'</span><span class=p>);</span>
        <span class=k>break</span><span class=p>;</span>
    <span class=k>case</span> <span class=s1>'coconut'</span><span class=err>:</span>
        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>'Third'</span><span class=p>);</span>
        <span class=k>break</span><span class=p>;</span>
    <span class=nl>default</span><span class=p>:</span>
        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>'Last'</span><span class=p>);</span>
<span class=p>}</span>
<span class=c1>// Logs "Second"</span>
</code></pre></div><p>A very common way to reduce the cyclomatic complexity with <code>switch</code> is to use a JavaScript object as a map. Instead of traversing the switch statement, do a lookup in the map where the key is the condition and the value is the action. For the example above this could look like this:</p><div class=highlight><pre><code class=language-javascript data-lang=javascript><span class=kr>const</span> <span class=nx>actions</span> <span class=o>=</span> <span class=p>{</span>
    <span class=na>apple</span><span class=p>:</span> <span class=nx>_</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>'First'</span><span class=p>),</span>
    <span class=na>banana</span><span class=p>:</span> <span class=nx>_</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>'Second'</span><span class=p>),</span>
    <span class=na>coconut</span><span class=p>:</span> <span class=nx>_</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>'Third'</span><span class=p>)</span>
<span class=p>}</span>
<span class=kr>const</span> <span class=nx>foo</span> <span class=o>=</span> <span class=s1>'banana'</span><span class=p>;</span>
<span class=k>if</span><span class=p>(</span><span class=nx>actions</span><span class=p>.</span><span class=nx>hasOwnProperty</span><span class=p>(</span><span class=nx>foo</span><span class=p>))</span> <span class=p>{</span>
    <span class=nx>actions</span><span class=p>[</span><span class=nx>foo</span><span class=p>]();</span>
<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>'Last'</span><span class=p>);</span>
<span class=p>}</span>
<span class=c1>// Logs "Second"</span>
</code></pre></div><p>This does not work directly with more complex conditions. e.g. a composite condition that checks against multiple parameters within one statement or between statements.</p><div class=highlight><pre><code class=language-javascript data-lang=javascript><span class=kd>function</span> <span class=nx>example</span><span class=p>(</span><span class=nx>error</span><span class=p>,</span> <span class=nx>stdout</span><span class=p>,</span> <span class=nx>stderr</span><span class=p>,</span> <span class=nx>mapping</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>if</span><span class=p>(</span><span class=nx>stderr</span> <span class=o>&amp;&amp;</span> <span class=nx>stderr</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=nx>stderr</span><span class=p>.</span><span class=nx>indexOf</span><span class=p>(</span><span class=s1>'A problem occurred'</span><span class=p>)</span> <span class=o>&gt;</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>'Not found'</span><span class=p>);</span>
    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=nx>error</span> <span class=o>||</span> <span class=p>(</span><span class=nx>stderr</span> <span class=o>&amp;&amp;</span> <span class=nx>stderr</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>))</span> <span class=p>{</span>
        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=err>`</span><span class=nx>Execution</span> <span class=nx>error</span> <span class=nx>$</span><span class=p>{[</span><span class=nx>error</span><span class=p>,</span> <span class=nx>stdout</span><span class=p>,</span> <span class=nx>stderr</span><span class=p>].</span><span class=nx>join</span><span class=p>(</span><span class=s1>'|'</span><span class=p>)}</span><span class=err>`</span><span class=p>);</span>
    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nb>Array</span><span class=p>.</span><span class=nx>isArray</span><span class=p>(</span><span class=nx>mapping</span><span class=p>))</span> <span class=p>{</span>
        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=err>`</span><span class=nx>Invalid</span> <span class=nx>configuration</span> <span class=nx>$</span><span class=p>{[</span><span class=nx>error</span><span class=p>,</span> <span class=nx>stdout</span><span class=p>,</span> <span class=nx>stderr</span><span class=p>,</span> <span class=nx>mapping</span><span class=p>].</span><span class=nx>join</span><span class=p>(</span><span class=s1>'|'</span><span class=p>)}</span><span class=err>`</span><span class=p>);</span>
    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>stdout</span> <span class=o>||</span> <span class=nx>stdout</span><span class=p>.</span><span class=nx>length</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>'No output'</span><span class=p>);</span>
    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>'Result from some process with mapping and stdout'</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
<span class=nx>example</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span><span class=kc>null</span><span class=p>,</span><span class=s1>'A problem occurred'</span><span class=p>);</span> <span class=c1>// Logs "Not found"</span>
<span class=nx>example</span><span class=p>(</span><span class=k>new</span> <span class=nb>Error</span><span class=p>());</span> <span class=c1>// Logs "Execution error Error||"</span>
<span class=nx>example</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span><span class=kc>null</span><span class=p>,</span><span class=kc>null</span><span class=p>,</span><span class=kc>null</span><span class=p>);</span> <span class=c1>// Logs "Invalid configuration |||"</span>
<span class=nx>example</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span><span class=s1>''</span><span class=p>,</span><span class=kc>null</span><span class=p>,[]);</span> <span class=c1>// Logs "No output"</span>
<span class=nx>example</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span><span class=s1>'Foo'</span><span class=p>,</span><span class=kc>null</span><span class=p>,[]);</span> <span class=c1>// Logs "Result from some process with mapping and stdout"</span>
</code></pre></div><p>In this case a JavaScript Array of objects can be used here, with one property holding the condition and another holding the desired action.</p><div class=highlight><pre><code class=language-javascript data-lang=javascript><span class=c1>// First part</span>
  <span class=kr>const</span> <span class=nx>actions</span> <span class=o>=</span> <span class=p>[{</span>
    <span class=na>condition</span><span class=p>:</span> <span class=nx>_</span> <span class=o>=&gt;</span> <span class=o>!</span><span class=nx>stdout</span> <span class=o>||</span> <span class=nx>stdout</span><span class=p>.</span><span class=nx>length</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>,</span>
    <span class=na>action</span><span class=p>:</span> <span class=nx>_</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>'No result'</span><span class=p>)</span>
  <span class=p>},</span> <span class=p>{</span>
    <span class=na>condition</span><span class=p>:</span> <span class=nx>_</span> <span class=o>=&gt;</span> <span class=o>!</span><span class=nb>Array</span><span class=p>.</span><span class=nx>isArray</span><span class=p>(</span><span class=nx>mapping</span><span class=p>),</span>
    <span class=na>action</span><span class=p>:</span> <span class=nx>_</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>'Config invalid'</span><span class=p>)</span>
  <span class=p>},</span> <span class=p>{</span>
    <span class=na>condition</span><span class=p>:</span> <span class=nx>_</span> <span class=o>=&gt;</span> <span class=nx>error</span> <span class=o>||</span> <span class=p>(</span><span class=nx>stderr</span> <span class=o>&amp;&amp;</span> <span class=nx>stderr</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>),</span>
    <span class=na>action</span><span class=p>:</span> <span class=nx>_</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>'Error executing'</span><span class=p>)</span>
  <span class=p>},</span> <span class=p>{</span>
    <span class=na>condition</span><span class=p>:</span> <span class=nx>_</span> <span class=o>=&gt;</span> <span class=nx>stderr</span> <span class=o>&amp;&amp;</span> <span class=nx>stderr</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=nx>stderr</span><span class=p>.</span><span class=nx>indexOf</span><span class=p>(</span><span class=s1>'A problem occurred'</span><span class=p>)</span> <span class=o>&gt;</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span>
    <span class=na>action</span><span class=p>:</span> <span class=nx>_</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>'Not found'</span><span class=p>)</span>
  <span class=p>}]</span>
</code></pre></div><p>It would be possible to loop over each entry with a <code>for</code> loop or an <a href=http://webuniverse.io/cyclomatic-complexity-refactoring-tips/ >iterator (see an example)</a>, but this is where the expressiveness of the functional operators <code>Array.prototype.filter</code> and <code>Array.prototype.reduce</code> shines.</p><div class=highlight><pre><code class=language-javascript data-lang=javascript><span class=c1>// Second part</span>
<span class=kd>function</span> <span class=nx>example</span><span class=p>(</span><span class=nx>error</span><span class=p>,</span> <span class=nx>stdout</span><span class=p>,</span> <span class=nx>stderr</span><span class=p>,</span> <span class=nx>mapping</span><span class=p>)</span> <span class=p>{</span>
  <span class=kr>const</span> <span class=nx>actions</span> <span class=o>=</span> <span class=p>...</span> <span class=c1>// See above</span>

  <span class=kr>const</span> <span class=nx>selectedAction</span> <span class=o>=</span> <span class=nx>actions</span>
    <span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>action</span> <span class=o>=&gt;</span> <span class=nx>action</span><span class=p>.</span><span class=nx>condition</span><span class=p>())</span>
    <span class=p>.</span><span class=nx>reduce</span><span class=p>((</span><span class=nx>accumulated</span><span class=p>,</span> <span class=nx>currentAction</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
      <span class=c1>// By design, reduce will only keep the last match when the accumulator </span>
      <span class=c1>// is ignored, so the order inside the actions array has significance.</span>
      <span class=k>return</span> <span class=nx>currentAction</span><span class=p>.</span><span class=nx>action</span><span class=p>;</span>
    <span class=p>},</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
      <span class=c1>// Else clause</span>
      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>'Result from some process with mapping and stdout'</span><span class=p>);</span>
    <span class=p>});</span>
  <span class=nx>selectedAction</span><span class=p>();</span>
<span class=p>}</span>

<span class=nx>example</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span> <span class=kc>null</span><span class=p>,</span> <span class=s1>'A problem occurred'</span><span class=p>);</span> <span class=c1>// Logs "Not found"</span>
<span class=nx>example</span><span class=p>(</span><span class=k>new</span> <span class=nb>Error</span><span class=p>());</span> <span class=c1>// Logs "Error executing"</span>
<span class=nx>example</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span> <span class=kc>null</span><span class=p>,</span> <span class=kc>null</span><span class=p>,</span> <span class=kc>null</span><span class=p>);</span> <span class=c1>// Logs "Config invalid"</span>
<span class=nx>example</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span> <span class=s1>''</span><span class=p>,</span> <span class=kc>null</span><span class=p>,</span> <span class=p>[]);</span> <span class=c1>// Logs "No result"</span>
<span class=nx>example</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span> <span class=s1>'Foo'</span><span class=p>,</span> <span class=kc>null</span><span class=p>,</span> <span class=p>[]);</span> <span class=c1>// Logs "Result from some process with mapping and stdout"</span>
</code></pre></div><p>A working example can be found in <a href=https://jsfiddle.net/mdvanes/367q8p35/ >this fiddle</a>.</p><p>This shows how to use functional operators to reduce cyclomatic complexity for an <code>if else</code> condition. Do keep in mind it may not be beneficial for performance. For instance, do not declare the action array inside of the function as in the example, as it would redeclare the array each time the function is executed. Another improvement would be to stop iteration in filter/reduce as soon as a matching action was found.</p><p>Also note that the example with the <code>if else</code> condition itself is quite readable, so it will not be worth the trade off of refactoring to resolution through an array of objects in this case.</p></div></div><div class="modal fade modal-terminal" id=contactModal tabindex=-1 role=dialog aria-labelledby=contactModalLabel aria-hidden=true><div class=modal-dialog><div class=modal-content><div class=modal-header><button type=button class=close data-dismiss=modal><span aria-hidden=true>&times;</span><span class=sr-only>Close</span></button><h4 class=modal-title id=myModalLabel>contact@mdworld</h4></div><div class=modal-body><form role=form id=contactForm><div class=form-group><label for=contactName>Name</label><input class=form-control id=contactName placeholder="Enter name" name=name required maxlength=1024></div><div class=form-group><label for=contactEmail>Email address</label><input type=email class=form-control id=contactEmail placeholder="Enter email" name=email required maxlength=1024></div><div class=form-group><label for=contactMessage>Message</label><textarea class=form-control id=contactMessage placeholder=Message name=message required maxlength=4096></textarea></div><button type=button class="btn btn-primary submit-contact">Submit</button></form></div></div></div></div><footer><div class="content container"><div class="row projects"><div class="col-xs-12 col-xl-4 col-xl-offset-2"><h2>Open Source by MDWorld</h2></div></div><div class="row projects"><div class="col-xs-12 col-sm-6 col-xl-4 col-xl-offset-2"><div class=media-wrapper><a class=media href=https://github.com/mdvanes/polygram><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>polygram</h4>Polymer and Redux App</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/mdworld-pwa-demo><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>mdworld-pwa-demo</h4>Progressive Web App demo</div></a></div><div class=media-wrapper><a class=media href=https://bitbucket.org/mdvanes/homeremote><span class="pull-left icon bitbucket"></span><div class=media-body><h4 class=media-heading>HomeRemote</h4>ES6 React and Node Home automation tool</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/generator-mdworld-toolchain><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>generator-mdworld-toolchain</h4>Yeoman generator to set up the mdworld toolchain</div></a></div><div class=media-wrapper><a class=media href=http://mdvanes.github.io/ImpossibleObjects/ ><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>ImpossibleObjects</h4>A selection of impossible objects using Canvas</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/grunt-kot2html><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>grunt-kot2html</h4>Grunt task to combine Knockout templates into one HTML</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/grunt-kot2js><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>grunt-kot2js</h4>Grunt task to convert Knockout templates to a JavaScript file</div></a></div></div><div class="col-xs-12 col-sm-6 col-xl-4"><div class=media-wrapper><a class=media href=https://github.com/mdvanes/mdworld-stox><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>mdworld-stox</h4>Websockets in Node.js demo</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/SynergyChrome><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>SynergyChrome</h4>Use Synergy in Chrome</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/Movienight><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>Movienight</h4>PoC for hybrid app with Ionic Framework</div></a></div><div class=media-wrapper><a class=media href=https://bitbucket.org/mdvanes/mderekelbox><span class="pull-left icon bitbucket"></span><div class=media-body><h4 class=media-heading>Rekelbox</h4>Arduino VU meter</div></a></div><div class=media-wrapper><a class=media href=https://bitbucket.org/mdvanes/mdepolska><span class="pull-left icon bitbucket"></span><div class=media-body><h4 class=media-heading>MDE Polska</h4>Polish keyboard Drupal module</div></a></div><div class=media-wrapper><a class=media href=https://bitbucket.org/mdvanes/mdegraph><span class="pull-left icon bitbucket"></span><div class=media-body><h4 class=media-heading>MDE Graph</h4>Javascript Graph PoC</div></a></div><div class=media-wrapper><a class=media href=https://bitbucket.org/mdvanes/mdeinsignificant><span class="pull-left icon bitbucket"></span><div class=media-body><h4 class=media-heading>Insignificant!</h4>loltext generator Drupal module</div></a></div></div></div><div class=row><h1 class=dedication>an MDWorld production</h1><p><a class=cc href=http://creativecommons.org/licenses/by-nc-sa/3.0/ title="Creative Commons">CC</a> 2003-2017</p></div></div></footer></div><!-- .site --><script src=/blog/js/scripts.js></script><!-- Run init for demo after loading jquery --><script>if(typeof(demoInit) === 'function') {
                demoInit();
            }</script></body></html>