<!DOCTYPE html><!--[if lt IE 9]> <html class="lt-ie9" lang="en"> <![endif]--><!--[if IE 9]>    <html class="ie9" lang="en"> <![endif]--><!--[if gt IE 9]><!--><html xmlns=http://www.w3.org/1999/xhtml class=gt-ie9 lang=en><!--<![endif]--><head><!-- version 0.3.5 --><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=author content="mdworld 0.3.5"><title>Dop SSD update</title><link rel="shortcut icon" href=/blog/img/favicon.ico type=image/x-icon><link rel=stylesheet href=/blog/css/all.css></head><body><div class=site><nav class="navbar navbar-inverse navbar-fixed-top"><div><div class=container><div class=row><ul class="nav navbar-nav navbar-right"><li><a href=/blog/ ><span class="glyphicon glyphicon-home"></span> home</a></li><li><a href=/blog/#blog><span class="glyphicon glyphicon-pencil"></span> blog</a></li><li><a href=https://twitter.com/mdworldNL><span class=twitter></span> <span class=label-optional>@mdworldNL</span></a></li><li><a href=# data-toggle=modal data-target=#contactModal><span class="glyphicon glyphicon-envelope"></span> <span class=label-optional>contact</span></a></li></ul></div></div></div><header><h1 class="title post-title container">Dop SSD update</h1></header></nav><p class="meta container">30 Apr 2015</p><div class="post container"><div class=multi-column-text><p>30-2-2015</p><p>I&#39;m replacing the 128GB SSD (Samsung 840 pro) by a 500GB SSD (Samsung 850 EVO) so I have enough space to move the /home partition to the SSD as well. I also had <a href=/blog/mypc/2015/03/02/dop-wont-boot/ >the problem</a> that suddenly my SSD is no longer booting, without using super grub disk, so I might solve this as well.</p><p>Currently, I have the SSD with the boot and root partitions on it, a 320GB HDD with the /home (ext3) and swap partitions and a 1,5 TB HDD for storage. I will replace the SSD and the 320GB by the 500GB SSD.</p><p>Booting a Ubuntu 13.04 live CD already gives some problems. Right after loading the desktop the system freezes. After multiple reboots it works normally. Using gparted to make exact copies of all partitions from the old SSD to the new SSD (just using copy/paste in gparted). I use a GPT partition table instead of msdos.</p><p>Now I disconnect the old SSD and reboot with the super grub disk, like I was doing before. This boots as expected. No I try to fix the boot issue.</p><h2>Making bootable</h2><p>After BIOS initialization the message &quot;no bootable partition found&quot; is displayed. Using F12 before boot to select the SSD manually doesn&#39;t work either, only super grub disk. I try to follow the official <a href=https://help.ubuntu.com/community/Boot-Repair>Boot Repair instructions</a>.</p><p>Following the second option &quot;install Boot-Repair in Ubuntu&quot; I first login to Ubuntu normally (still booting with super grub disk) to install boot-repair:</p><div class=highlight><pre><code class=language- data-lang="">sudo add-apt-repository ppa:yannubuntu/boot-repair
sudo apt-get update
sudo apt-get install -y boot-repair &amp;&amp; boot-repair
</code></pre></div><p>But when I try to run it (<code>boot-repair</code> and selecting &quot;recommended repair&quot;) I get a message:</p><div class=highlight><pre><code class=language- data-lang="">Please create a BIOS-Boot partition: (&gt;1MB, unformatted filesystem, bios_grub flag). This can be performed by tools like gparted, then try again.
</code></pre></div><p>So, let&#39;s follow these detailed instructions!</p><p>The current situation is:</p><div class=highlight><pre><code class=language- data-lang="">/dev/sdc1 fat32       249MiB    label EFI   flags msftdata
/dev/sdc2 ext4        118.98GiB             flags msftdata
/dev/sdc3 linux-swap   15.62GiB
</code></pre></div><p>The fat32 partition was copied from the old SSD. I manually removed the fat32 partition and replaced it with an unformatted BIOS-boot partition and then I rebooted as instructed by gparted. Surprisingly, the partition still shows up as a fat32 partition so I select it and choose &gt; format &gt; cleared. Know the partion is listed as &quot;unknown&quot;.</p><p>Setting the flag &quot;bios_grub&quot; gives this result for /dev/sdc1:</p><div class=highlight><pre><code class=language- data-lang="">/dev/sdc1 unknown 249MiB, flags bios_grub
</code></pre></div><p>I rerun boot-repair &gt; recommended repair, but get another error:</p><div class=highlight><pre><code class=language- data-lang="">The boot of your PC is in EFI mode, but no EFI partition was deteced. You may want to retry after creating a EFI partiiton (FAT32, 100~250MB, start of disk, boot flag). Do you want to continue.
</code></pre></div><p>So I cancel and try to create the EFI partition from a part of the bios-boot partition with gparted:</p><div class=highlight><pre><code class=language- data-lang="">/dev/sdc4 fat32      244Mib    label EFI   flags boot, esp
/dev/sdc1 unknown      5MiB                flags bios_grub
/dev/sdc2 ext4       118.98GiB             flags msftdata
/dev/sdc3 linux-swap  15.62GiB
</code></pre></div><p>Now I close gparted and run boot-repair &gt; recommended repair for the third time, just to get this error again:</p><div class=highlight><pre><code class=language- data-lang="">The boot of your PC is in EFI mode, but no EFI partition was deteced. You may want to retry after creating a EFI partiiton (FAT32, 100~250MB, start of disk, boot flag). Do you want to continue.
</code></pre></div><p>Now I see no other choice then to continue and I get a progress window telling me that &quot;repair file systems sdb1 this may require several minutes&quot;. That&#39;s odd, because sdb1 is not the new ssd. Anyway, after 30 minutes of running, I cancelled it and rebooted. And of course it still doesn&#39;t work.</p><p>Apparently this was all futile and I switch to the <a href=(https://help.ubuntu.com/community/RecoveringUbuntuAfterInstallingWindows>non-graphical instructions to restore grub</a>). Now I&#39;m trying:</p><div class=highlight><pre><code class=language- data-lang="">sudo grub-install /dev/sdc
</code></pre></div><p>This is done instantly. After rebooting and using F12 to select the boot device, I can now select the new SSD partition and boot Ubuntu. Progress!</p><p>Unfortunately, booting still requires me to select the correct drive manually. This should be easy, just go into the BIOS and change the boot order. But where the boot order is listed, only 2 devices show up: the 1,5TB HDD and the optical drive. After frantic searching in the BIOS and online, I realize something like this might be mentioned in the manual (it is a Gigabyte Z87-HD3 motherboard), and indeed:</p><ul><li>go to BIOS, switch to classic mode</li><li>go to tab BIOS features</li><li>now below boot order there is something like:<ul><li>DVD bbs priorities</li><li>hard disk bbs priorities</li></ul></li><li>click hard disk bbs priorities and here I can change the order.</li></ul><p>Now it boots directly into Ubuntu! It&#39;s using legacy boot and not EFI, but that&#39;s fine.</p><h2>Moving /home</h2><p>Copying data from one disk to another is easy, but I want to change the formatting from ext3 to ext4 at the same time and of course it contains /home, so I need to update the mount point.</p><ul><li>Use gparted to create new partition on the new SSD:</li></ul><div class=highlight><pre><code class=language- data-lang="">/dev/sdc5 ext4 330.91GiB
</code></pre></div><ul><li>Use rsync to copy from the old to the new partition.<ul><li>The syntax is <code>rsync --progress -a source dest</code></li><li>from /dev/sda3 -&gt; /media/ubuntu/9af1dc04-72d9-43a9-a67c-c11f2118dfa6</li><li>to /dev/sdc5 -&gt; /media/ubuntu/211c3ec1-1314-492d-946e-8cb3d24888a9</li><li>so using <code>rsync --progress -a /media/ubuntu/9af1dc04-72d9-43a9-a67c-c11f2118dfa6 /media/ubuntu/211c3ec1-1314-492d-946e-8cb3d24888a9</code> (WARNING: this is a minor mistake because it creates a dir 9af1dc04-72d9-43a9-a67c-c11f2118dfa6 on the new drive, see below)</li><li>I also run <code>watch -n30 df --type=ext4 --type=ext3 -BG</code> to have an indication of the progress</li></ul></li><li>I immediately see that plenty of dirs give the error &quot;rsync: open dir: permission denied&quot;, so I run the same instruction but with sudo. Now it runs much longer. In a couple of hours everything is copied. Running it again logs nothing copied, so it seems to have been successful.</li></ul><p>Now the reference of the /home mount point needs to be <a href=https://help.ubuntu.com/community/Partitioning/Home/Moving>fixed</a></p><ul><li>the contents of /media/ubuntu/1ea18a24-56eb-4a89-9f54-f9d547c88e35/etc/fstab list as (only relevant parts):</li></ul><div class=highlight><pre><code class=language- data-lang=""># / was on /dev/sda1 during installation
UUID=1ea18a24-56eb-4a89-9f54-f9d547c88e35 /       ext4   errors=remount-ro  0  1
# /home was on /dev/sdb3 during installation
UUID=9af1dc04-72d9-43a9-a67c-c11f2118dfa6 /home   ext3   defaults           0  2
# swap was on /dev/sdb2 during installation
UUID=079723eb-16f6-487f-b5bb-588d48ce0d55 none    swap   sw                 0  0
</code></pre></div><ul><li>listing all UUID with <code>sudo blkid</code> (only relevant parts):</li></ul><div class=highlight><pre><code class=language- data-lang="">/dev/sda2: UUID="079723eb-16f6-487f-b5bb-588d48ce0d55" TYPE="swap"
/dev/sda3: UUID="9af1dc04-72d9-43a9-a67c-c11f2118dfa6" SEC_TYPE="ext2" TYPE="ext3"
/dev/sdc2: UUID="1ea18a24-56eb-4a89-9f54-f9d547c88e35" TYPE="ext4"
/dev/sdc3: UUID="fbac86d0-4f93-4d8e-a762-dda9c2a61105" TYPE="swap"
/dev/sdc5: UUID="211c3ec1-1314-492d-946e-8cb3d24888a9" TYPE="ext4"
</code></pre></div><ul><li>changed fstab to (only relevant parts:</li></ul><div class=highlight><pre><code class=language- data-lang=""># / was on /dev/sdc2 after move to new SSD
UUID=1ea18a24-56eb-4a89-9f54-f9d547c88e35 /       ext4   errors=remount-ro 0  1
# /home was on /dev/sdc5 after move to new SSD
UUID=211c3ec1-1314-492d-946e-8cb3d24888a9 /home   ext4   defaults          0  2
# swap was on /dev/sdc3 after move to new SSD
UUID=fbac86d0-4f93-4d8e-a762-dda9c2a61105 none    swap   sw                0  0
</code></pre></div><ul><li>after rebooting, login failed. Relogged with live CD and found that the /home was copied to a subdir of the new drive. Copied it to the main dir and rebooted. Login in worked normally and is very fast! (How fast? 30 seconds from pressing the power button to seeing the homepage in Firefox)</li></ul><p>And finally, when removing the old HDD from the case, I accidentally broke off a system fan pin from the motherboard. The other system fan pins are too far away and the other system fan already died some time ago. Now the only fan is the CPU fan, but so far it seems to be managing with a coretemp of max. 35&deg;C and a CPU temp of max 26&deg;C.</p></div></div><div class="modal fade modal-terminal" id=contactModal tabindex=-1 role=dialog aria-labelledby=contactModalLabel aria-hidden=true><div class=modal-dialog><div class=modal-content><div class=modal-header><button type=button class=close data-dismiss=modal><span aria-hidden=true>&times;</span><span class=sr-only>Close</span></button><h4 class=modal-title id=myModalLabel>contact@mdworld</h4></div><div class=modal-body><form role=form id=contactForm><div class=form-group><label for=contactName>Name</label><input class=form-control id=contactName placeholder="Enter name" name=name required maxlength=1024></div><div class=form-group><label for=contactEmail>Email address</label><input type=email class=form-control id=contactEmail placeholder="Enter email" name=email required maxlength=1024></div><div class=form-group><label for=contactMessage>Message</label><textarea class=form-control id=contactMessage placeholder=Message name=message required maxlength=4096></textarea></div><button type=button class="btn btn-primary submit-contact">Submit</button></form></div></div></div></div><footer><div class="content container"><div class="row projects"><div class="col-xs-12 col-xl-4 col-xl-offset-2"><h2>Open Source by MDWorld</h2></div></div><div class="row projects"><div class="col-xs-12 col-sm-6 col-xl-4 col-xl-offset-2"><div class=media-wrapper><a class=media href=https://github.com/mdvanes/polygram><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>polygram</h4>Polymer and Redux App</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/mdworld-pwa-demo><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>mdworld-pwa-demo</h4>Progressive Web App demo</div></a></div><div class=media-wrapper><a class=media href=https://bitbucket.org/mdvanes/homeremote><span class="pull-left icon bitbucket"></span><div class=media-body><h4 class=media-heading>HomeRemote</h4>ES6 React and Node Home automation tool</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/generator-mdworld-toolchain><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>generator-mdworld-toolchain</h4>Yeoman generator to set up the mdworld toolchain</div></a></div><div class=media-wrapper><a class=media href=http://mdvanes.github.io/ImpossibleObjects/ ><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>ImpossibleObjects</h4>A selection of impossible objects using Canvas</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/grunt-kot2html><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>grunt-kot2html</h4>Grunt task to combine Knockout templates into one HTML</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/grunt-kot2js><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>grunt-kot2js</h4>Grunt task to convert Knockout templates to a JavaScript file</div></a></div></div><div class="col-xs-12 col-sm-6 col-xl-4"><div class=media-wrapper><a class=media href=https://github.com/mdvanes/mdworld-stox><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>mdworld-stox</h4>Websockets in Node.js demo</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/SynergyChrome><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>SynergyChrome</h4>Use Synergy in Chrome</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/Movienight><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>Movienight</h4>PoC for hybrid app with Ionic Framework</div></a></div><div class=media-wrapper><a class=media href=https://bitbucket.org/mdvanes/mderekelbox><span class="pull-left icon bitbucket"></span><div class=media-body><h4 class=media-heading>Rekelbox</h4>Arduino VU meter</div></a></div><div class=media-wrapper><a class=media href=https://bitbucket.org/mdvanes/mdepolska><span class="pull-left icon bitbucket"></span><div class=media-body><h4 class=media-heading>MDE Polska</h4>Polish keyboard Drupal module</div></a></div><div class=media-wrapper><a class=media href=https://bitbucket.org/mdvanes/mdegraph><span class="pull-left icon bitbucket"></span><div class=media-body><h4 class=media-heading>MDE Graph</h4>Javascript Graph PoC</div></a></div><div class=media-wrapper><a class=media href=https://bitbucket.org/mdvanes/mdeinsignificant><span class="pull-left icon bitbucket"></span><div class=media-body><h4 class=media-heading>Insignificant!</h4>loltext generator Drupal module</div></a></div></div></div><div class=row><h1 class=dedication>an MDWorld production</h1><p><a class=cc href=http://creativecommons.org/licenses/by-nc-sa/3.0/ title="Creative Commons">CC</a> 2003-2017</p></div></div></footer></div><!-- .site --><script src=/blog/js/scripts.js></script><!-- Run init for demo after loading jquery --><script>if(typeof(demoInit) === 'function') {
                demoInit();
            }</script></body></html>