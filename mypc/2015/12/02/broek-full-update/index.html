<!DOCTYPE html><!--[if lt IE 9]> <html class="lt-ie9" lang="en"> <![endif]--><!--[if IE 9]>    <html class="ie9" lang="en"> <![endif]--><!--[if gt IE 9]><!--><html xmlns=http://www.w3.org/1999/xhtml class=gt-ie9 lang=en><!--<![endif]--><head><!-- version 0.3.5 --><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=author content="mdworld 0.3.5"><title>Full update for Broek</title><link rel="shortcut icon" href=/blog/img/favicon.ico type=image/x-icon><link rel=stylesheet href=/blog/css/all.css></head><body><div class=site><nav class="navbar navbar-inverse navbar-fixed-top"><div><div class=container><div class=row><ul class="nav navbar-nav navbar-right"><li><a href=/blog/ ><span class="glyphicon glyphicon-home"></span> home</a></li><li><a href=/blog/#blog><span class="glyphicon glyphicon-pencil"></span> blog</a></li><li><a href=https://twitter.com/mdworldNL><span class=twitter></span> <span class=label-optional>@mdworldNL</span></a></li><li><a href=# data-toggle=modal data-target=#contactModal><span class="glyphicon glyphicon-envelope"></span> <span class=label-optional>contact</span></a></li></ul></div></div></div><header><h1 class="title post-title container">Full update for Broek</h1></header></nav><p class="meta container">02 Dec 2015</p><div class="post container"><div class=multi-column-text><p><strong>2-12-2015</strong> After updating some packages, I rebooted for the first time after a long time. I thought it would help with cleaning up unused kernels on the boot partition. The box apparently hangs on boot, but no keyboard/monitor are connected so this can still be anything. After connecting some peripherals, nothing happened. Upon trying to reboot the power LED stays on and doesn&#39;t respond to pressing (and holding) the power button. Removing and reinserting the power cable is the final straw: now nothing happens, even the power LED stays off.</p><p><strong>3-12-2015</strong> In a last attempt to find the culprit, I disassembled the box and plugged in old PSU. Upon connecting power and switching the PSU on, it&#39;s fan twitches, but does not start spinning normally. Pressing the power button on the motherboard has no visible effect. The motherboard has probably died.</p><p>Building a replacement was already planned, but now has to be rushed unfortunately, so these parts were ordered:</p><ul><li>(mobo) ASRock B85M Pro4</li><li>(ram) 2x Crucial DDR3 DIMM 1x4GB 1600 C11</li><li>(cpu) Intel Celeron G1840</li><li>(case) Cooler Master Silencio 352</li><li>(fan) Noctua NH-L9i</li><li>(psu) Seasonic G-Serie 360Watt</li></ul><p>Additionally, I will re-use the drives (80GB + 3TB) and a Samsung 840 SSD (128GB) that I have lying around.</p><p><strong>12-12-2015</strong> After assembeling the parts and just popping in the hard drives the system boots normally, although getting the secondary drive to work this requires fixing its entry in /etc/fstab.</p><p>The ethernet adapter is not working, which makes sense, because it is a different on-board adapter.</p><ul><li>I can&#39;t ping outside the system</li><li>The ethernet lights next to the port are on</li><li><code>ifconfig</code> lists a br0 and an lo device, but no eth0</li><li>lspci lists the Ethernet Controller as Intel I217-V</li><li>running <code>sudo lshw -C network</code> gives <code>*-network DISABLED</code></li><li>running <code>dmesg | grep eth</code> gives <code>eth0: link is not ready</code></li><li>renamed network interface eth0 to eth1, then ran:</li></ul><div class=highlight><pre><code class=language- data-lang="">sudo modprobe e100
sudo ifconfig eth1 up
</code></pre></div><ul><li>did not work, but no errors.</li><li>According to <a href=http://www.serenux.com/2009/11/howto-fix-a-missing-eth0-adapter-after-moving-ubuntu-server-from-one-box-to-another/ >this article</a> I need to edit <code>/etc/udev/rules.d/70-persistent-net.rules</code> (as root) and comment out the old ethernet device</li><li>After rebooting, it detects the ethernet adapter automatically.</li></ul><p><strong>13-12-2015</strong> Of course, since the on-board sound card also changed, its drivers also needs to be reconfigured. I plugged the speakers into the lime port, I just want to use 2 channel sound.</p><ul><li><code>aplay /usr/share/sounds/alsa/Front_Center.wav</code> gives an error.</li><li><code>sudo aplay -l</code> does lists several cards, one being PCH ALC892 analog</li><li>when using alsamixer, I see that HDMI is set as the default out. The old motherboard did not have HDMI out, so it did detect this new HDMI correctly. This should be changed to analog.</li><li>I tried several things that had no effect, such as reinstalling alsa and rebooting, and changing the default device with <code>pacmd list-cards</code></li><li>Eventually, running <code>lspci -knn|grep -iA2 audio</code> shows I&#39;m using snd<em>hda</em>intel kernel driver</li><li>I edit <code>/etc/modprobe.d/alsa-base.conf</code> as root</li><li>I add the line <code>options snd_hda_intel index=1</code> under the last &quot;install&quot; statement</li><li>Now I run <code>sudo alsa force-reload</code></li><li>run alsamixer: now analog is active!</li><li>run <code>aplay /usr/share/sounds/alsa/Front_Center.wav</code>. I hear the sound!</li></ul><p>The case and fans were picked for being very silent. Unfortunately, they are still quite loud at the moment. I did have the sense to pick a case with PWM fans, so I need to configure those.</p><p><a href=http://askubuntu.com/questions/22108/how-to-control-fan-speed>This article</a> describes how to set it up.</p><ul><li>Install: <code>sudo apt-get install lm-sensors fancontrol</code></li><li>Configure lm-sensors: <code>sudo sensors-detect</code></li></ul><p>With the result:</p><div class=highlight><pre><code class=language- data-lang="">#----cut here----
# Chip drivers
coretemp
nct6775
#----cut here----
</code></pre></div><ul><li>After starting the service, <code>sensors</code> gives output. I see coretemp around 30 C and RPMs for fan1, fan2, fan5.</li><li>Configure fancontrol: <code>sudo pwmconfig</code></li></ul><div class=highlight><pre><code class=language- data-lang="">Found the following devices:
   hwmon0/device is coretemp
   hwmon1 is nct6776

Found the following PWM controls:
  hwmon1/pwm2           current value: 165
  hwmon1/pwm3           current value: 165
respond to changes, pwm1 doesn't. Probably the two chassis fans.
</code></pre></div><p>I have a <a href=http://www.silentpcreview.com/Noctua_NH-L9i>Noctua NH-L9i CPU fan</a> so I could use the Low-Noise adapter, but lets first try PWM.</p><p>Fan2 seems to be the CPU fan, because the fan speed corresponds with the max speed of the Noctua NH-L9i. During pwmconfig I found out that setting the speed below 2000 RPM will greatly reduce the sound production. This means the low-noise adapter would definitely help. The CPU fan is hwmon1/fan2_input and is controlled by pwm hwmon1/pwm2.</p><p>After configuring both fans with pwmconfig, I start fancontrol service: <code>sudo service fancontrol start</code> and the noise dropped significantly!</p><p>The front fan (I think, I can&#39;t really hear it that well) is still quite noisy. It doesn&#39;t respond to configuring by pwmconfig, for some reason. I might just turn it off. The state after configuring:</p><ul><li>fan1 (front?): was 1100 before configuration &rarr; after configuration 1100 (unchanged)</li><li>fan2 (cpu): 2500 &rarr; 1150</li><li>fan3 (rear?): 1100 &rarr; 380</li></ul><p><strong>15-12-2015</strong> Added the low noise adapter to the front fan. Running <code>sensors</code>:</p><ul><li>fan1 (front): 1100 &rarr; 881.</li><li>fan2 (cpu): 980</li><li>fan5 (rear): 327.</li><li>Cpu temp around 32 C</li></ul><p>The noise production is now is very low.</p><p>I&#39;ve also added two extra drives (an SSD and an old 1,5TB HDD) that need to be configured. Running <code>sudo lsblk -o NAME,FSTYPE,SIZE,MOUNTPOINT,LABEL</code> gives:</p><div class=highlight><pre><code class=language- data-lang="">NAME                    FSTYPE        SIZE MOUNTPOINT  LABEL
sda                                   2.7T            
`-sda1                  ext4          2.7T /mnt/disk3t
sdb                                  74.5G            
|-sdb1                  ext2          243M /boot      
|-sdb2                                  1K            
`-sdb5                  LVM2_member  74.3G            
  |-broek-root (dm-0)   ext4         71.8G /          
  `-broek-swap_1 (dm-1) swap          2.5G [SWAP]     
sdc                                   1.4T            
`-sdc1                  ext3          1.4T             OldDrive
sdd                                 119.2G            
|-sdd1                  ext4          119G            
`-sdd3                  vfat          249M             EFI
</code></pre></div><p>The filesystem sizes give away which drives are which and even the label of one of the drives is still intact. For the moment I mount them manually:</p><div class=highlight><pre><code class=language-bash data-lang=bash>sudo mount /dev/sdc1 /mnt/disk1500g
sudo mount /dev/sdd1 /mnt/diskSsdTemp
</code></pre></div><p>Both seem to work, so I just added them to the fstab and configured the 1,5TB drive as an export via Webmin.</p><p>At this moment only the USB device <a href=https://bitbucket.org/mdvanes/mderekelbox>Rekelbox</a> doesn&#39;t work anymore. I thought it might need an update of the USB drivers, not unlike the audio and network drivers before. The initPort.sh script fails with <code>stty: /dev/ttyUSB0: Inappropriate ioctl for device</code>. Trying to find a solution gives many hits, non of which seem appropriate for my case. Trying a USB flash drive works fine, so I don&#39;t think it&#39;s the USB drivers.</p><p>After searching messageboards for a long time, I just tried rebooting with the USB device plugged in: it started working immediately!</p></div></div><div class="modal fade modal-terminal" id=contactModal tabindex=-1 role=dialog aria-labelledby=contactModalLabel aria-hidden=true><div class=modal-dialog><div class=modal-content><div class=modal-header><button type=button class=close data-dismiss=modal><span aria-hidden=true>&times;</span><span class=sr-only>Close</span></button><h4 class=modal-title id=myModalLabel>contact@mdworld</h4></div><div class=modal-body><form role=form id=contactForm><div class=form-group><label for=contactName>Name</label><input class=form-control id=contactName placeholder="Enter name" name=name required maxlength=1024></div><div class=form-group><label for=contactEmail>Email address</label><input type=email class=form-control id=contactEmail placeholder="Enter email" name=email required maxlength=1024></div><div class=form-group><label for=contactMessage>Message</label><textarea class=form-control id=contactMessage placeholder=Message name=message required maxlength=4096></textarea></div><button type=button class="btn btn-primary submit-contact">Submit</button></form></div></div></div></div><footer><div class="content container"><div class="row projects"><div class="col-xs-12 col-xl-4 col-xl-offset-2"><h2>Open Source by MDWorld</h2></div></div><div class="row projects"><div class="col-xs-12 col-sm-6 col-xl-4 col-xl-offset-2"><div class=media-wrapper><a class=media href=https://github.com/mdvanes/polygram><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>polygram</h4>Polymer and Redux App</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/mdworld-pwa-demo><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>mdworld-pwa-demo</h4>Progressive Web App demo</div></a></div><div class=media-wrapper><a class=media href=https://bitbucket.org/mdvanes/homeremote><span class="pull-left icon bitbucket"></span><div class=media-body><h4 class=media-heading>HomeRemote</h4>ES6 React and Node Home automation tool</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/generator-mdworld-toolchain><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>generator-mdworld-toolchain</h4>Yeoman generator to set up the mdworld toolchain</div></a></div><div class=media-wrapper><a class=media href=http://mdvanes.github.io/ImpossibleObjects/ ><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>ImpossibleObjects</h4>A selection of impossible objects using Canvas</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/grunt-kot2html><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>grunt-kot2html</h4>Grunt task to combine Knockout templates into one HTML</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/grunt-kot2js><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>grunt-kot2js</h4>Grunt task to convert Knockout templates to a JavaScript file</div></a></div></div><div class="col-xs-12 col-sm-6 col-xl-4"><div class=media-wrapper><a class=media href=https://github.com/mdvanes/mdworld-stox><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>mdworld-stox</h4>Websockets in Node.js demo</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/SynergyChrome><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>SynergyChrome</h4>Use Synergy in Chrome</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/Movienight><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>Movienight</h4>PoC for hybrid app with Ionic Framework</div></a></div><div class=media-wrapper><a class=media href=https://bitbucket.org/mdvanes/mderekelbox><span class="pull-left icon bitbucket"></span><div class=media-body><h4 class=media-heading>Rekelbox</h4>Arduino VU meter</div></a></div><div class=media-wrapper><a class=media href=https://bitbucket.org/mdvanes/mdepolska><span class="pull-left icon bitbucket"></span><div class=media-body><h4 class=media-heading>MDE Polska</h4>Polish keyboard Drupal module</div></a></div><div class=media-wrapper><a class=media href=https://bitbucket.org/mdvanes/mdegraph><span class="pull-left icon bitbucket"></span><div class=media-body><h4 class=media-heading>MDE Graph</h4>Javascript Graph PoC</div></a></div><div class=media-wrapper><a class=media href=https://bitbucket.org/mdvanes/mdeinsignificant><span class="pull-left icon bitbucket"></span><div class=media-body><h4 class=media-heading>Insignificant!</h4>loltext generator Drupal module</div></a></div></div></div><div class=row><h1 class=dedication>an MDWorld production</h1><p><a class=cc href=http://creativecommons.org/licenses/by-nc-sa/3.0/ title="Creative Commons">CC</a> 2003-2017</p></div></div></footer></div><!-- .site --><script src=/blog/js/scripts.js></script><!-- Run init for demo after loading jquery --><script>if(typeof(demoInit) === 'function') {
                demoInit();
            }</script></body></html>