<!DOCTYPE html><!--[if lt IE 9]> <html class="lt-ie9" lang="en"> <![endif]--><!--[if IE 9]>    <html class="ie9" lang="en"> <![endif]--><!--[if gt IE 9]><!--><html xmlns=http://www.w3.org/1999/xhtml class=gt-ie9 lang=en><!--<![endif]--><head><!-- version 0.3.5 --><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=author content="mdworld 0.3.5"><title>Trusty Broek LTS</title><link rel="shortcut icon" href=/mdworld-ingram/img/favicon.ico type=image/x-icon><link rel=stylesheet href=/mdworld-ingram/css/all.css></head><body><div class=site><nav class="navbar navbar-inverse navbar-fixed-top"><div><div class=container><div class=row><ul class="nav navbar-nav navbar-right"><li><a href=/mdworld-ingram/ ><span class="glyphicon glyphicon-home"></span> home</a></li><li><a href=/mdworld-ingram/#blog><span class="glyphicon glyphicon-pencil"></span> blog</a></li><li><a href=https://twitter.com/mdworldNL><span class=twitter></span> <span class=label-optional>@mdworldNL</span></a></li><li><a href=# data-toggle=modal data-target=#contactModal><span class="glyphicon glyphicon-envelope"></span> <span class=label-optional>contact</span></a></li></ul></div></div></div><header><h1 class="title post-title container">Trusty Broek LTS</h1></header></nav><p class="meta container">17 Aug 2014</p><div class="post container"><div class=multi-column-text><p>Disclaimer: this was posted 21-11-2014, but it was written around 17-08-2014.</p><p>This post details the update from my server &quot;broek&quot; from Ubuntu 12.04.1 to <a href=http://releases.ubuntu.com/14.04/ >14.04.1</a> (both LTS). Broek is now running 12.04.1 and 14.04 (the new LTS) has been available for half a year so I will try to update to that.</p><p>The initial steps:</p><ul><li>upgrade webmin to newest version</li><li>update packages</li><li>updated owncloud to 7.0.1 (from 6) - had to force and upgrade database through web interface</li><li>updating to 14.04.1 lts: <code>sudo do-release-upgrade</code></li></ul><p>I get this warning (as always):</p><div class=highlight><pre><code class=language- data-lang="">This session appears to be running under ssh. It is not recommended
to perform a upgrade over ssh currently because in case of failure it
is harder to recover.

If you continue, an additional ssh daemon will be started at port
'1022'.
Do you want to continue?

To make recovery in case of failure easier, an additional sshd will
be started on port '1022'. If anything goes wrong with the running
ssh you can still connect to the additional one.

If you run a firewall, you may need to temporarily open this port. As
this is potentially dangerous it's not done automatically. You can
open the port with e.g.:
'iptables -I INPUT -p tcp --dport 1022 -j ACCEPT'
</code></pre></div><ul><li>Now I find that the disk is too full. The partition /boot is 100% full:</li></ul><div class=highlight><pre><code class=language- data-lang="">Not enough free disk space

The upgrade has aborted. The upgrade needs a total of 55.6 M free
space on disk '/boot'. Please free at least an additional 55.6 M of
disk space on '/boot'. Empty your trash and remove temporary packages
of former installations using 'sudo apt-get clean'.
</code></pre></div><p>I manually clean up the /boot and retry the do-release-upgrade. I get warnings about config files that are modified in the update:</p><ul><li>/etc/sysctl.conf was changed - keep current</li><li>/etc/samba/smb.conf - keep current</li><li>/etc/ppp/pptpd-options - keep current</li><li>/etc/pptpd.conf - keep current</li><li>/etc/apache2/ports.conf - keep current</li><li>/etc/rsyslog.conf - keep current</li></ul><p>It restarts but I can&#39;t SSH in. When I turn on the monitor it turns out it hangs because no keyboard is plugged in (the old keyboard that was plugged in apparently died). When connecting a working keyboard it continues normally after pressing F1.</p><p>Deleted Ubuntu One NFS share through webmin. When booting saw that is was still mounted. Ubuntu One has been discontinued by now.</p><h2>Apache</h2><p>I tried to create an extra Owncloud account and notice that Owncloud can&#39;t be reached. Actually no Apache sites can&#39;t be reached. This is probably because of the <a href=http://askubuntu.com/questions/452042/why-is-my-apache-not-working-after-upgrading-to-ubuntu-14-04>Apache configuration change</a> that expects all resources in /var/www/html instead of /var/www that was done in Ubuntu 14.04.</p><p>Moving everything from /var/www to /var/www/html works, but I get when accessing Owncloud I&#39;m greeted with the message:</p><div class=highlight><pre><code class=language- data-lang="">[14] SQLSTATE[HY000] [14] unable to open database file
</code></pre></div><p>I figured I would modify the file /var/www/html/owncloud/config/config.php. There is an entry datadirectory and I changed the path here also to /var/www/html/owncloud/data. Now Owncloud works again!</p><ul><li>tested VPN: it works!</li><li>tested external owncloud access (subdir of main domain): it works.</li></ul><h2>External Subdomains</h2><p>Tested external subdomains (virtualhosts): they don&#39;t work, probably because of the move to /var/www/html. When running sudo a2ensite subdomain.mdworld.nl (subdomain is a placeholder for one of the actual subdomains) I get:</p><p><code>ERROR: Site subdomain.mdworld.nl does not exist!</code></p><p>This seems to be because in this version of Apache the configurations in /etc/apache2/sites-available (e.g. subdomain.mdworld.nl) need to end in .conf. So I renamed it to subdomain.mdworld.nl.conf and ran:</p><div class=highlight><pre><code class=language- data-lang="">sudo a2ensite subdomain.mdworld.nl # (without .conf!) 
sudo service apache2 restart
</code></pre></div><p>Now it works again.</p><h2>boot partition</h2><p>/boot was 228MB and it gets full pretty fast. I considered making it about 1.5GB, but apparently it should not be necessary to resize the /boot partition. Since at least 2013 Ubuntu should <a href=http://askubuntu.com/questions/369105/what-is-ubuntus-policy-on-keeping-old-kernels>clean up old kernels automatically</a> and otherwise the policy should be to run <code>apt-get autoremove</code> manually. It actually seems cleaner already, I now have 141MB available on /boot.</p><h2>Owncloud</h2><p>When logged in as admin under admin settings I get this warning:</p><div class=highlight><pre><code class=language- data-lang="">Security Warning

Your data directory and your files are probably accessible from the internet. The .htaccess file is not working. We strongly suggest that you configure your webserver in a way that the data directory is no longer accessible or you move the data directory outside the webserver document root.
</code></pre></div><p>There is a .htaccess file in /var/www/html/owncloud/data, but it seems all my .htaccess files are being ignored. I configured them in /etc/apache2/httpd.conf. This no longer exists. I now have Apache 2.4.7 and apparently it&#39;s now necessary to modify /etc/apache2/sites-available/000-default.conf. In this conf I add:</p><div class=highlight><pre><code class=language- data-lang="">&lt;Directory "/var/www/html/owncloud"&gt;
AllowOverride All
&lt;/Directory&gt;
</code></pre></div><p>This works!</p><p>Then I couldn&#39;t access owncloud from &quot;semi local&quot; network (between modem and router) because the ip was not in trusted domains. Added the ip to /var/www/html/owncloud/config/config.php and it worked without restarting any services.</p><p>Now I notice that on my desktop, in the Owncloud client there is an error. It seemed to work before but now it says: <code>csync failed to access webdav</code></p><p>Client version is now 1.6.2 but server 7. I thought this was the problem, but these are apparently the newest versions. Reinstalling is adviced, but I decide to investigate further. When I access https://localhost/owncloud/remote.php/webdav/public it has some kind of error.</p><p>Looking at the <a href=https://github.com/owncloud/3rdparty/blob/master/Sabre/DAV/Client.php>code for Client.php</a> you can see it throws those exceptions when curl throws an error.</p><p>The <a href=http://doc.owncloud.org/server/5.0/admin_manual/installation/installation_source.html>manual installation page</a> states that curl is an optional dependency, not required, so I disabled it in php.ini (comment out the line that says extension=php_curl.dll), restarted IIS and it got rid of the error on the Admin page and also fixed my sync clients.</p><p>I forgot to change the paths to the public and protected subsites (which were moved to /var/www/html) in the admin settings. This seems to work now.</p><h2>To do</h2><ul><li>When logged in through SSH, I sometimes get the message: <code>no talloc stackframe at ../source3/param/loadparm.c:4864, leaking memory</code></li><li>When running a2ensite I get: <code>perl: warning: Setting locale failed.</code></li><li>I might want to re-enable third party sources in the sources.list</li></ul></div></div><div class="modal fade modal-terminal" id=contactModal tabindex=-1 role=dialog aria-labelledby=contactModalLabel aria-hidden=true><div class=modal-dialog><div class=modal-content><div class=modal-header><button type=button class=close data-dismiss=modal><span aria-hidden=true>&times;</span><span class=sr-only>Close</span></button><h4 class=modal-title id=myModalLabel>contact@mdworld</h4></div><div class=modal-body><form role=form id=contactForm><div class=form-group><label for=contactName>Name</label><input class=form-control id=contactName placeholder="Enter name" name=name required maxlength=1024></div><div class=form-group><label for=contactEmail>Email address</label><input type=email class=form-control id=contactEmail placeholder="Enter email" name=email required maxlength=1024></div><div class=form-group><label for=contactMessage>Message</label><textarea class=form-control id=contactMessage placeholder=Message name=message required maxlength=4096></textarea></div><button type=button class="btn btn-primary submit-contact">Submit</button></form></div></div></div></div><footer><div class="content container"><div class="row projects"><div class="col-xs-12 col-xl-4 col-xl-offset-2"><h2>Open Source by MDWorld</h2></div></div><div class="row projects"><div class="col-xs-12 col-sm-6 col-xl-4 col-xl-offset-2"><div class=media-wrapper><a class=media href=https://github.com/mdvanes/polygram><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>polygram</h4>Polymer and Redux App</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/mdworld-pwa-demo><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>mdworld-pwa-demo</h4>Progressive Web App demo</div></a></div><div class=media-wrapper><a class=media href=https://bitbucket.org/mdvanes/homeremote><span class="pull-left icon bitbucket"></span><div class=media-body><h4 class=media-heading>HomeRemote</h4>ES6 React and Node Home automation tool</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/generator-mdworld-toolchain><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>generator-mdworld-toolchain</h4>Yeoman generator to set up the mdworld toolchain</div></a></div><div class=media-wrapper><a class=media href=http://mdvanes.github.io/ImpossibleObjects/ ><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>ImpossibleObjects</h4>A selection of impossible objects using Canvas</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/grunt-kot2html><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>grunt-kot2html</h4>Grunt task to combine Knockout templates into one HTML</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/grunt-kot2js><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>grunt-kot2js</h4>Grunt task to convert Knockout templates to a JavaScript file</div></a></div></div><div class="col-xs-12 col-sm-6 col-xl-4"><div class=media-wrapper><a class=media href=https://github.com/mdvanes/mdworld-stox><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>mdworld-stox</h4>Websockets in Node.js demo</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/SynergyChrome><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>SynergyChrome</h4>Use Synergy in Chrome</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/Movienight><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>Movienight</h4>PoC for hybrid app with Ionic Framework</div></a></div><div class=media-wrapper><a class=media href=https://bitbucket.org/mdvanes/mderekelbox><span class="pull-left icon bitbucket"></span><div class=media-body><h4 class=media-heading>Rekelbox</h4>Arduino VU meter</div></a></div><div class=media-wrapper><a class=media href=https://bitbucket.org/mdvanes/mdepolska><span class="pull-left icon bitbucket"></span><div class=media-body><h4 class=media-heading>MDE Polska</h4>Polish keyboard Drupal module</div></a></div><div class=media-wrapper><a class=media href=https://bitbucket.org/mdvanes/mdegraph><span class="pull-left icon bitbucket"></span><div class=media-body><h4 class=media-heading>MDE Graph</h4>Javascript Graph PoC</div></a></div><div class=media-wrapper><a class=media href=https://bitbucket.org/mdvanes/mdeinsignificant><span class="pull-left icon bitbucket"></span><div class=media-body><h4 class=media-heading>Insignificant!</h4>loltext generator Drupal module</div></a></div></div></div><div class=row><h1 class=dedication>an MDWorld production</h1><p><a class=cc href=http://creativecommons.org/licenses/by-nc-sa/3.0/ title="Creative Commons">CC</a> 2003-2018</p></div></div></footer></div><!-- .site --><script src=/mdworld-ingram/js/scripts.js></script><!-- Run init for demo after loading jquery --><script>if(typeof(demoInit) === 'function') {
                demoInit();
            }</script></body></html>