<!DOCTYPE html><!--[if lt IE 9]> <html class="lt-ie9" lang="en"> <![endif]--><!--[if IE 9]>    <html class="ie9" lang="en"> <![endif]--><!--[if gt IE 9]><!--><html xmlns=http://www.w3.org/1999/xhtml class=gt-ie9 lang=en><!--<![endif]--><head><!-- version 0.3.5 --><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=author content="mdworld 0.3.5"><title>Discourse on Ubuntu 14.04</title><link rel="shortcut icon" href=/mdworld-ingram/img/favicon.ico type=image/x-icon><link rel=stylesheet href=/mdworld-ingram/css/all.css></head><body><div class=site><nav class="navbar navbar-inverse navbar-fixed-top"><div><div class=container><div class=row><ul class="nav navbar-nav navbar-right"><li><a href=/mdworld-ingram/ ><span class="glyphicon glyphicon-home"></span> home</a></li><li><a href=/mdworld-ingram/#blog><span class="glyphicon glyphicon-pencil"></span> blog</a></li><li><a href=https://twitter.com/mdworldNL><span class=twitter></span> <span class=label-optional>@mdworldNL</span></a></li><li><a href=# data-toggle=modal data-target=#contactModal><span class="glyphicon glyphicon-envelope"></span> <span class=label-optional>contact</span></a></li></ul></div></div></div><header><h1 class="title post-title container">Discourse on Ubuntu 14.04</h1></header></nav><p class="meta container">16 Nov 2014</p><div class="post container"><div class=multi-column-text><p>I wanted to try and use <a href=https://www.docker.com/ >Docker</a> after hearing such great things about it. Since I might want to roll out a decent forum at some point, I wanted to look into installing <a href=http://www.discourse.org/ >Discourse</a>. For the moment, this will be done on my desktop.</p><p>I start with the <a href=http://docs.docker.com/installation/ubuntulinux/ >installation instructions</a> for Docker on Ubuntu 14.04.</p><ul><li>For Discourse it&#39;s needed to follow the instructions for the newest version of Docker and not to use the default Ubuntu package.</li></ul><p>I proceed with <a href=http://www.howtoinstalldiscourse.com/how-to-install-discourse-on-ubuntu/ >this tutorial</a> that specifies to run:</p><div class=highlight><pre><code class=language- data-lang="">wget -qO- https://get.docker.io/ | sh
mkdir /var/docker
git clone https://github.com/discourse/discourse_docker.git /var/docker
cd /var/docker
cp samples/standalone.yml containers/app.yml
</code></pre></div><p>I modify /var/docker/containers/app.yml (all relevant changes to app.yml are at the bottom)</p><div class=highlight><pre><code class=language- data-lang="">DISCOURSE_HOSTNAME: 'localhost'
</code></pre></div><p>but on running start <code>sudo ./launcher start app</code> I get:</p><div class=highlight><pre><code class=language- data-lang="">2014/11/16 10:46:31 Error response from daemon: Cannot start container 270d47cd8401c50f13e0a1e51428f5b9833a9480b53bc98735df55b425a70b6d: Error starting userland proxy: listen tcp 0.0.0.0:80: bind: address already in use
</code></pre></div><p>This could be expected, because Apache runs on port 80.</p><p>in /var/docker/containers/app.yml there is an entry:</p><div class=highlight><pre><code class=language- data-lang="">expose:
  - "80:80"   # fwd host port 80   to container port 80 (http)
  - "2222:22" # fwd host port 2222 to container port 22 (ssh)
</code></pre></div><p>After using <code>netstat -antp</code> to confirm port 8080 is unused, I change 80:80 to 8080:80 in the app.yml.</p><p>Now I rebuild and restart the container:</p><div class=highlight><pre><code class=language- data-lang="">cd /var/docker
sudo ./launcher rebuild app # this applies the changes
sudo ./launcher start app
</code></pre></div><p>When I use the browser to go to http://localhost:8080/, it immediately gives me Discourse page!</p><p>Now I notice, when creating the admin account, that the activation mail is not send. Thinking back I did skip over the mail settings in the app.yml.</p><p>Here I had to experiment a bit with my mail settings and this turned out in the end what took most of the time for getting Discourse up and running. One thing I learned is that it&#39;s not neccesary to stop the app with <code>sudo ./launcher stop app</code> before making changes or rebuilding.</p><p>Soon I find that running <code>sudo ./launcher mailtest app</code> gives much more useful information, thanks to <a href=https://meta.discourse.org/t/discourse-new-install-registration-emails-not-sent-because-from-address-cant-be-changed/16663/11>this thread</a>.</p><p>I configure the app.yml to use the Google smtp server (settings are below), but <code>sudo ./launcher mailtest app</code> still gives an error:</p><div class=highlight><pre><code class=language- data-lang="">ERROR: python yaml module not installed - run the following and try again:

sudo apt-get install python3-yaml
</code></pre></div><p>After installing this package mailtest tells me there is an authentication problem and apparently I need to allow &quot;less secure apps&quot; access to my gmail account. After setting this up at Google accounts, I can send mail with mailtest.</p><p>The activate mail link is now send and I can access the admin panel in Discourse.</p><p>I have also tried to set up mail with the SMTP settings of my own ISP, but this gave an error that I could not find any solutions to:</p><div class=highlight><pre><code class=language- data-lang="">Traceback (most recent call last):
  File "/var/docker/scripts/mailtest", line 138, in &lt;module&gt;
    smtp = smtplib.SMTP(smtp_addr, smtp_port, timeout=5)
  File "/usr/lib/python3.4/smtplib.py", line 242, in __init__
    (code, msg) = self.connect(host, port)
  File "/usr/lib/python3.4/smtplib.py", line 321, in connect
    self.sock = self._get_socket(host, port, self.timeout)
  File "/usr/lib/python3.4/smtplib.py", line 292, in _get_socket
    self.source_address)
  File "/usr/lib/python3.4/socket.py", line 509, in create_connection
    raise err
  File "/usr/lib/python3.4/socket.py", line 500, in create_connection
    sock.connect(sa)
OSError: [Errno 113] No route to host
</code></pre></div><p>Since I never use my ISP&#39;s mail server, it might simply be that I use the wrong SMTP address or something.</p><p>In the end, I use these setting in my app.yml (these are just the edited fragments):</p><div class=highlight><pre><code class=language- data-lang="">expose:
  - "8080:80"  # fwd host port 80   to container port 80 (http)
  - "2222:22"  # fwd host port 2222 to container port 22 (ssh)

  DISCOURSE_DEVELOPER_EMAILS: 'myemail@example.com'

  DISCOURSE_HOSTNAME: 'localhost'

  DISCOURSE_SMTP_ADDRESS: smtp.gmail.com
  DISCOURSE_SMTP_PORT: 587
  DISCOURSE_SMTP_USER_NAME: mygmail@gmail.com
  DISCOURSE_SMTP_PASSWORD: ******
</code></pre></div><p>I wonder now, since I&#39;m starting discourse now with <code>./launcher start app</code> if I should have renamed the containers/app.yml to discourse.yml to be able to start Discourse with <code>./launcher start discourse</code>? I don&#39;t know how difficult (or easy?) it will be to change this afterwards, but I will leave it for another time to figure this out.</p></div></div><div class="modal fade modal-terminal" id=contactModal tabindex=-1 role=dialog aria-labelledby=contactModalLabel aria-hidden=true><div class=modal-dialog><div class=modal-content><div class=modal-header><button type=button class=close data-dismiss=modal><span aria-hidden=true>&times;</span><span class=sr-only>Close</span></button><h4 class=modal-title id=myModalLabel>contact@mdworld</h4></div><div class=modal-body><form role=form id=contactForm><div class=form-group><label for=contactName>Name</label><input class=form-control id=contactName placeholder="Enter name" name=name required maxlength=1024></div><div class=form-group><label for=contactEmail>Email address</label><input type=email class=form-control id=contactEmail placeholder="Enter email" name=email required maxlength=1024></div><div class=form-group><label for=contactMessage>Message</label><textarea class=form-control id=contactMessage placeholder=Message name=message required maxlength=4096></textarea></div><button type=button class="btn btn-primary submit-contact">Submit</button></form></div></div></div></div><footer><div class="content container"><div class="row projects"><div class="col-xs-12 col-xl-4 col-xl-offset-2"><h2>Open Source by MDWorld</h2></div></div><div class="row projects"><div class="col-xs-12 col-sm-6 col-xl-4 col-xl-offset-2"><div class=media-wrapper><a class=media href=https://github.com/mdvanes/polygram><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>polygram</h4>Polymer and Redux App</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/mdworld-pwa-demo><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>mdworld-pwa-demo</h4>Progressive Web App demo</div></a></div><div class=media-wrapper><a class=media href=https://bitbucket.org/mdvanes/homeremote><span class="pull-left icon bitbucket"></span><div class=media-body><h4 class=media-heading>HomeRemote</h4>ES6 React and Node Home automation tool</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/generator-mdworld-toolchain><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>generator-mdworld-toolchain</h4>Yeoman generator to set up the mdworld toolchain</div></a></div><div class=media-wrapper><a class=media href=http://mdvanes.github.io/ImpossibleObjects/ ><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>ImpossibleObjects</h4>A selection of impossible objects using Canvas</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/grunt-kot2html><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>grunt-kot2html</h4>Grunt task to combine Knockout templates into one HTML</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/grunt-kot2js><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>grunt-kot2js</h4>Grunt task to convert Knockout templates to a JavaScript file</div></a></div></div><div class="col-xs-12 col-sm-6 col-xl-4"><div class=media-wrapper><a class=media href=https://github.com/mdvanes/mdworld-stox><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>mdworld-stox</h4>Websockets in Node.js demo</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/SynergyChrome><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>SynergyChrome</h4>Use Synergy in Chrome</div></a></div><div class=media-wrapper><a class=media href=https://github.com/mdvanes/Movienight><span class="pull-left icon github"></span><div class=media-body><h4 class=media-heading>Movienight</h4>PoC for hybrid app with Ionic Framework</div></a></div><div class=media-wrapper><a class=media href=https://bitbucket.org/mdvanes/mderekelbox><span class="pull-left icon bitbucket"></span><div class=media-body><h4 class=media-heading>Rekelbox</h4>Arduino VU meter</div></a></div><div class=media-wrapper><a class=media href=https://bitbucket.org/mdvanes/mdepolska><span class="pull-left icon bitbucket"></span><div class=media-body><h4 class=media-heading>MDE Polska</h4>Polish keyboard Drupal module</div></a></div><div class=media-wrapper><a class=media href=https://bitbucket.org/mdvanes/mdegraph><span class="pull-left icon bitbucket"></span><div class=media-body><h4 class=media-heading>MDE Graph</h4>Javascript Graph PoC</div></a></div><div class=media-wrapper><a class=media href=https://bitbucket.org/mdvanes/mdeinsignificant><span class="pull-left icon bitbucket"></span><div class=media-body><h4 class=media-heading>Insignificant!</h4>loltext generator Drupal module</div></a></div></div></div><div class=row><h1 class=dedication>an MDWorld production</h1><p><a class=cc href=http://creativecommons.org/licenses/by-nc-sa/3.0/ title="Creative Commons">CC</a> 2003-2018</p></div></div></footer></div><!-- .site --><script src=/mdworld-ingram/js/scripts.js></script><!-- Run init for demo after loading jquery --><script>if(typeof(demoInit) === 'function') {
                demoInit();
            }</script></body></html>